
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Thijs Lensselink's Blog</title>
  <meta name="author" content="Thijs Lensselink">

  
  <meta name="description" content="Google Mod_pagespeed Continued Last week i toyed with mod_pagespeed a bit. But just couldn’t get the hang of it. So the last two days permitted me &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lenss.nl/page/6/">
  <link href="http://lenss.nl/favicon.png" rel="icon">
  <link href="http://lenss.nl/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="http://lenss.nl/javascripts/libs/jquery-1.8.1.js"></script>
  <script src="http://lenss.nl/javascripts/modernizr-2.0.js"></script>
  <script src="http://lenss.nl/javascripts/ender.js"></script>
  <script src="http://lenss.nl/javascripts/octopress.js"></script>
  <script src="http://lenss.nl/javascripts/github.js"></script>
  <script src="http://lenss.nl/javascripts/twitter.js"></script>
  <link href="http://feeds.feedburner.com/ThijsLensselinksBlog" rel="alternate" title="Thijs Lensselink's Blog" type="application/atom+xml">
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8003524-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <script type="text/javascript">
	$(document).ready(function() {
		$('#logo').click(function() {
			window.location = '/';
		});
	});
  </script>
</head>

<body   >
<div id="content">
	<div class="inner">
        <div class="blog-index">
  
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2010/11/google-mod_pagespeed-continued/">Google Mod_pagespeed Continued</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>Last week i <a href="http://lenss.nl/2010/11/google-mod_pagespeed/">toyed</a> with <a href="http://code.google.com/p/modpagespeed/">mod_pagespeed</a> a bit. But just couldn’t get the hang of it. So the last two days permitted me to play some more with this great Apache module. Only this time i choose to <a href="http://code.google.com/p/modpagespeed/wiki/HowToBuild">build from source</a> and ignore the binaries for a while. </p>

<p>For me the main problem was. As soon as i enabled the module. It was active for all sites running on this server. And that should not be a problem. But some of these sites are Wordpress monsters. That are ready to take any server down with a bit of high load.</p>

<p>So after a bit of trail and error. I figured out i could just disable mod_pagespeed globally by altering the main config file. After Apache reloaded mod_pagespeed was not active for the running sites.</p>

<p>in /etc/apache2/mods-available/pagespeed.conf make sure ModPagespeed is set to ‘off’</p>

<blockquote>
  <p>ModPagespeed off</p>
</blockquote>

<p>So now i can simply enable settings i need on a per vhost basis. For this site end some other sites i used the following config section in my vhost.</p>

<blockquote>
  <ul>
    <li>MOD-pagespeed</li>
    <li>SetOutputFilter MOD_PAGESPEED_OUTPUT_FILTER</li>
    <li>ModPagespeed on</li>
    <li>ModPagespeedUrlPrefix                “http://lenss.nl”</li>
    <li></li>
    <li>ModPagespeedFileCachePath            “/var/mod_pagespeed/cache/”</li>
    <li>ModPagespeedGeneratedFilePrefix      “/var/mod_pagespeed/files/”</li>
    <li></li>
    <li>ModPagespeedRewriteLevel CoreFilters</li>
    <li>ModPagespeedRewriteLevel PassThrough</li>
    <li></li>
    <li>ModPagespeedEnableFilters add_head</li>
    <li>ModPagespeedEnableFilters collapse_whitespace</li>
    <li>ModPagespeedEnableFilters elide_attributes</li>
    <li>ModPagespeedEnableFilters remove_comments</li>
    <li>ModPagespeedEnableFilters rewrite_css</li>
    <li>ModPagespeedEnableFilters rewrite_javascript</li>
    <li>ModPagespeedEnableFilters move_css_to_head</li>
  </ul>
</blockquote>

<p>First of we enable mod_pagespeed of course. And then we set the current domain for this instance. After that we set the file paths for the altered and cached files. And we use ‘PassThrough’ instead of ‘CoreFilters’. So we can decide our self’s what filters we will be using.</p>

<p>This had a much better result then my previous attempts. The server was still happily serving pages. And the load was OK. So let’s check the sites if mod_pagespeed is actually running.</p>

<blockquote>
  <p>$ wget -O /dev/null –server-response http://lenss.nl 2&gt;&amp;1| grep -i ‘X-Mod-Pagespeed’
  X-Mod-Pagespeed: 0.9.0.0-172</p>
</blockquote>

<p>Well that looks good. So now it’s time to do some testing. And this leaves me with a bit of a pickle. As i don’t have the required wget v 1.12 (i have a small patch for wget v1.11). Besides that i have some other problems running the tests</p>

<blockquote>
  <p>TEST: 404s are served and properly recorded.
      wget -O /dev/null http://lenss.nl/mod_pagespeed/ic.a.bad.css 2&gt;&amp;1| grep -q ‘404 Not Found’
      wget -q -O - –save-headers http://localhost:80/mod_pagespeed_statistics | grep -q ‘resource_404_count: 1’
FAIL.</p>
</blockquote>

<p>This fails because the statistics page requested is not available because this site uses rewrites. And i haven’t found a way to go around this yet besides disabling them in .htaccess with mod_rewrite. So shortly disabling this made it possible to run the biggest part of the test suite without problems. </p>

<blockquote>
  <ul>
    <li>resource_fetches: 2</li>
    <li>total_page_load_ms: 0</li>
    <li>page_load_count: 0</li>
    <li>cache_extensions: 0</li>
    <li>not_cacheable: 0</li>
    <li>css_file_count_reduction: 0</li>
    <li>css_filter_files_minified: 13</li>
    <li>css_filter_minified_bytes_saved: 5082</li>
    <li>css_filter_parse_failures: 0</li>
    <li>css_elements: 0</li>
    <li>image_inline: 0</li>
    <li>image_rewrite_saved_bytes: 0</li>
    <li>image_rewrites: 0</li>
    <li>javascript_blocks_minified: 15</li>
    <li>javascript_bytes_saved: 380</li>
    <li>javascript_minification_failures: 0</li>
    <li>javascript_total_blocks: 15</li>
    <li>resource_url_domain_rejections: 0</li>
    <li>url_trims: 0</li>
    <li>url_trim_saved_bytes: 0</li>
    <li>resource_404_count: 2</li>
    <li>slurp_404_count: 0</li>
    <li>serf_fetch_request_count: 0</li>
    <li>serf_fetch_bytes_count: 0</li>
    <li>serf_fetch_time_duration_ms: 0</li>
    <li>serf_fetch_cancel_count: 0</li>
  </ul>
</blockquote>

<p>It fails on the image compression part and that’s fine. Because i will leave that for later. So let’s run the site through the pagespeed browser extension with mod_pagespeed disabled:</p>

<blockquote>
  <p>load time without : 2.193
firebug/pagespeed score : 68</p>
</blockquote>

<p>Now the same thing but with mod_pagespeed enabled:</p>

<blockquote>
  <p>Load time with : 1.284
firebug/pagespeed score : 90</p>
</blockquote>

<p>That looks pretty good. And the other sites i have tested preform way better with the mod_pagespeed module enabled.</p>

<p>I still have some Javascript issues. Some things need further inspection because i have seen error like these coming along:</p>

<blockquote>
  <p>Permission denied for  to call method Location.toString on .</p>
</blockquote>

<p>Besides that. This morning my site was down due to Apache spitting segfaults. I disabled the ‘rewrite_javascript’ filter for now. And it seems to run a bit more stable.</p>

<blockquote>
  <p>[Thu Nov 11 07:38:24 2010] [notice] child pid 23608 exit signal Segmentation fault (11)</p>
</blockquote>

<p>So besides it being a beta i am pretty impressed by the current state of this module. And after running it for a couple of weeks the statistics are pretty impressive.</p>

<p><img src="http://lenss.nl/images/2010/12/page-speed.jpg" alt="" /></p>

<p>Manuel Lemos also wrote a nice article about <a href="http://www.phpclasses.org/blog/post/135-Accelerate-Web-Pages-Automatically-using-Google-ModPageSpeed-Unusual-Site-Speedup-Techniques-Part-4.html">mod_pagespeed</a> which is worth reading.</p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2010-11-11T12:08:45+01:00" pubdate data-updated="true">Nov 11<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/-home/'>/home</a>, <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/google/'>Google</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2010/11/google-mod_pagespeed-continued/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2010/11/compiling-php-v1-0-8/">Compiling PHP v1.0.8</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>Today <a href="http://lerdorf.com/bio.php">Rasmus</a> posted on <a href="http://twitter.com/#!/rasmus">twitter</a> that he just compiled PHP v 1.0.8. And it actually worked. Is that great? :) He was in need of this for his upcoming talk this week in Paris. But i couldn’t resist and try to compile this ancient piece of work ;)</p>

<blockquote>
  <p>$ wget http://museum.php.net/php1/php-108.tar.gz
$ tar xfvz php-108.tar.gz
$ cd php </p>
</blockquote>

<p>If you need to change any config setting do it now. And hit make!</p>

<blockquote>
  <p>$ vi config.h
$ make</p>
</blockquote>

<p>This creates a few .cgi files. So it actually does still build </p>

<blockquote>
  <p>phpf.cgi
phpl.cgi
phplmon.cgi
phplview.cgi</p>
</blockquote>

<p>Let’s copy that to my cgi-bin and run it through Apache.</p>

<p><a href="http://lenss.nl/images/2010/11/php-1.0.8.jpg"><img src="http://lenss.nl/images/2010/11/php-1.0.8-300x263.jpg" alt="" /></a></p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2010-11-08T18:47:58+01:00" pubdate data-updated="true">Nov 8<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/-home/'>/home</a>, <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2010/11/compiling-php-v1-0-8/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2010/11/changing-mysql-for-mariadb/">Changing Mysql for MariaDB</a></h1>
	
	</header>
</header>


  <div class="articletext"><p><a href="http://mariadb.org/"><img src="http://lenss.nl/images/2010/11/mariadb.png" alt="" /></a>Ok so i quit smoking 4 days ago now. And i am having some serious sleep issues at the moment. i have been up half the night sitting here staring at my screen. But nothing really productive comes out of my hands. So while doing a bit of browsing i hit the <a href="http://mariadb.org/">MariaDB</a> page. And has been while since i was here. The last time there was no real downloadable package yet. But this has all changed.</p>

<p>So that made me think about last week. I think it was on Friday. but there was some up stirring about <a href="http://www.mysql.com/products/">MySQL</a> (Oracle) asking a license fee for using the <a href="http://www.innodb.com/">InnoDB</a> storage engine. And quite a big fee if you ask me :) This really sucks. I love the InnoDB engine. What would we do without it…? That’s where MariaDB comes into play. It uses the <a href="https://launchpad.net/percona-xtradb">XtraDB</a> storage engine which is basically InnoDB on steroids. XtraDB is developed and maintained by <a href="http://www.percona.com/">Percona</a>. Some really smart MySQL guys :) At the moment it’s under the <a href="http://www.gnu.org/licenses/gpl.html">GPL</a> license. And i can only hope it will be freely available for a long time.</p>

<p>So i went ahead and took a look at how hard / easy it is to change MySQL for MariaDB. I tried this on a Debian Lenny machine which made the process quite easy i have to mention.</p>

<p>First get the PGP key from the server and import the repository locations. After that hit update to refresh the local database.</p>

<blockquote>
  <ul>
    <li>
      <table>
        <tbody>
          <tr>
            <td>$ wget -O- http://ourdelta.org/deb/ourdelta.gpg</td>
            <td>sudo apt-key add -</td>
          </tr>
        </tbody>
      </table>
    </li>
    <li>$ cd /etc/apt/sources.list.d; wget http://mirror.ourdelta.org/deb/sources/lenny-mariadb-ourdelta.list</li>
    <li>$ aptitude update</li>
  </ul>
</blockquote>

<p>As we can see we have some new packages</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
Get:8 http://mirror.ourdelta.org lenny/mariadb-ourdelta Sources [864B]
Current status: 3 updates [+3], 232 new [+11].
</pre></div>
</div>
 </figure></notextile></div>

<p>Searching for ‘mariadb’ gives the following packages</p>

<blockquote>
  <p>$ aptitude search mariadb</p>
</blockquote>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
p   libmariadbclient-dev              - MariaDB database development files
p   libmariadbclient16                - MariaDB database client library
v   libmariadbclient16-dev            - MariaDB embedded database development files 
p   mariadb-client                    - MariaDB database client (metapackage depending on the latest version)
p   mariadb-client-5.1                - MariaDB database client binaries
p   mariadb-client-core-5.1           - MariaDB database core client binaries
v   mariadb-common 
p   mariadb-server                    - MariaDB database server (metapackage depending on the latest version)
p   mariadb-server-5.1                - MariaDB database server binaries
p   mariadb-test                      - MariaDB database regression test suite (metapackage depending on the latest version)
p   mariadb-test-5.1                  - MariaDB database regression test suite
</pre></div>
</div>
 </figure></notextile></div>

<p>So let’s go ahead and install the server and see what happens.</p>

<blockquote>
  <p>$ aptitude install mariadb-server</p>
</blockquote>

<p>Some mysql files get removed the mysql-common package gets updated and the new MariaDB packages get installed.</p>

<blockquote>

  <ul>
    <li><strong>The following NEW packages will be installed:</strong></li>
    <li>libmariadbclient16{a} </li>
    <li>libmysqlclient16{a} </li>
    <li>mariadb-client-5.1{a} </li>
    <li>mariadb-client-core-5.1{a} </li>
    <li>mariadb-server </li>
    <li>mariadb-server-5.1{a} </li>
  </ul>
</blockquote>

<blockquote>

  <ul>
    <li><strong>The following packages will be REMOVED:</strong></li>
    <li>mysql-client-5.0{a} </li>
    <li>mysql-server{a} </li>
    <li>mysql-server-5.0{a} </li>
  </ul>
</blockquote>

<blockquote>

  <ul>
    <li><strong>The following packages will be upgraded:</strong></li>
    <li>mysql-common</li>
  </ul>
</blockquote>

<p>Now that’s done. Let’s check MySQL’s output</p>

<blockquote>
  <p>$ mysql –version
* mysql  Ver 14.16 Distrib 5.1.49-MariaDB, for debian-linux-gnu (i486) using readline 5.1</p>
</blockquote>

<p>Just as i expected. Nothing really changed here. The whole MySQL API is till available for calling. Only the base system is now replaced by MariaDB. So let’s see what storage engines are available.</p>

<blockquote>

  <p>$ mysql -uroot -p</p>
</blockquote>

<blockquote>
  <ul>
    <li>MariaDB [(none)]&gt; show engines;</li>
    <li><strong>BLACKHOLE</strong>     _/dev/null storage engine (anything you write to it disappears) _</li>
    <li><strong>MRG_MYISAM</strong>  _Collection of identical MyISAM tables _</li>
    <li><strong>FEDERATED</strong>     _FederatedX pluggable storage engine  _</li>
    <li><strong>MARIA</strong>            _Crash-safe tables with MyISAM heritage _</li>
    <li>**CSV **              _ CSV storage engine _</li>
    <li>**MEMORY **        _Hash based, stored in memory, useful for temporary tables  _</li>
    <li>**ARCHIVE **        _Archive storage engine  _</li>
    <li><strong>MyISAM</strong>          _Default engine as of MySQL 3.23 with great performance  _</li>
    <li><strong>InnoDB</strong>           _Supports transactions, row-level locking, and foreign keys _</li>
    <li><strong>PBXT</strong>              <em>High performance, multi-versioning transactional engine</em></li>
  </ul>
</blockquote>

<p>And because the MySQL APi is still in tact. From PHP we can keep using the mysql and mysqli interfaces. This is great stuff!</p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2010-11-08T07:19:45+01:00" pubdate data-updated="true">Nov 8<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/sql/'>SQL</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2010/11/changing-mysql-for-mariadb/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2010/11/google-mod_pagespeed/">Google Mod_pagespeed</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>Yesterday Google <a href="http://googlewebmastercentral.blogspot.com/2010/11/make-your-websites-run-faster.html">released</a> a <strong>beta</strong> version of their upcoming Apache module <a href="http://code.google.com/speed/page-speed/docs/using_mod.html">mod_pagespeed</a>.</p>

<p>And this seems like a very promising project indeed. It mainly is a suite that provides web optimisation features to make your sites run faster. Right now 15 of such features are available.</p>

<blockquote>
  <p>including optimising caching, minimising client-server round trips and minimising payload size.</p>
</blockquote>

<p>So no more manual image compressing and javascript, html and css minifying.</p>

<p>It uses the Apache <em>SetOutputFilter</em> to register the output filter. And from thereon you can use <em>ModPagespeedEnableFilters</em> to enable certain filters. </p>

<p>Filters like:</p>

<blockquote>
  <p><strong>add_head</strong>
<em>Add the head section if missing</em></p>
</blockquote>

<p><strong>move_css_to_head</strong>
<em>Moves CSS into the head of the page (needs add_head)</em></p>

<p><strong>combine_css</strong>
<em>Combine multiple CSS tags into one.</em></p>

<p><strong>rewrite_css,rewrite_javascript</strong>
<em>Remove comments and white spaces</em></p>

<p><strong>rewrite_images</strong>
<em>Compress / re encode images</em></p>

<p>More info about the filters can be found <a href="http://code.google.com/speed/page-speed/docs/filters.html">here</a></p>

<p>So i went ahead and <a href="http://code.google.com/speed/page-speed/download.html">downloaded</a> the Debian version to give it a try. And as always it’s straight forward from here.</p>

<blockquote>
  <p>dpkg -i mod-pagespeed-beta_current_i386.deb</p>
</blockquote>

<p>It hooks nicely into Apache and creates the .load and .conf files in <em>/etc/apache2/mods-available</em>. After a Apache restart everything looked fine. And the pages did seem to load faster. Google also offers a <a href="http://www.modpagespeed.com/">test suite</a> to see the result of this module in action.</p>

<p>Running the tests showed a small speed increase. But at the moment my daytime hours are spend behind a horrible firewall that really screws with web output. So i have to redo those for more accurate results. Never the less. This is a module to keep an eye on.</p>

<p>It’s still a very young project. And i did have some server issues today. So related or not. Be careful :)</p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2010-11-04T23:05:42+01:00" pubdate data-updated="true">Nov 4<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2010/11/google-mod_pagespeed/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2010/11/jquery-php-doing-simple-image-slicing/">Jquery & PHP Doing Simple Image Slicing</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>Today i was in need of a basic image slicer. An there must be a million of these things out there. But i wanted to see how hard / easy it would be to create this myself.</p>

<p>Conclusion. It’s not that hard when using the jquery library. which is becoming my Javascript framework of choice.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">js/jquery-1.4.3.min.js</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/javascript</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">js/jquery-ui-1.8.5.custom.min.js</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/javascript</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
</pre></div>
</div>
 </figure></notextile></div>

<p>I started with a div.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">image_slicer_canvas</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>
</pre></div>
</div>
 </figure></notextile></div>

<p>Then i added the placeholder for the to be scaled image. And a div that will represent the slicer borders.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">image_slicer_canvas</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;img</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">images/sample.jpg</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">image_slicer_image</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/img&gt;</span>
  <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">image_slicer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">image_slicer_scaler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>
  <span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/div&gt;</span>
</pre></div>
</div>
 </figure></notextile></div>

<p>The next thing to do is setup the scaling canvas. So let’s make it draggable and resizeable.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="comment">// Create a draggable / scalable slicer</span>
<span class="predefined">$</span>(<span class="keyword">function</span>() {
  <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#image_slicer</span><span class="delimiter">'</span></span>)
    .draggable({<span class="key">containment</span>:<span class="string"><span class="delimiter">'</span><span class="content">#image_slicer_canvas</span><span class="delimiter">'</span></span>}) <span class="comment">// constraint</span>
    .resizable();
    
  <span class="comment">// set the slicer canvas size</span>
  resizeCanvas(
    <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#image_slicer_image</span><span class="delimiter">'</span></span>).width(),
    <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#image_slicer_image</span><span class="delimiter">'</span></span>).height()
  );
});
</pre></div>
</div>
 </figure></notextile></div>

<p>The only thing we need now is a bit of javascript to handle the slice action. I used a sample form to do the posting to the slicer.php script</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="comment">// handle slicer actions</span>
<span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#image_slicer</span><span class="delimiter">'</span></span>).resizable({
  <span class="function">stop</span>: <span class="keyword">function</span>(event, ui) { 
    <span class="keyword">var</span> pos = <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#image_slicer</span><span class="delimiter">'</span></span>).position();
  
    <span class="comment">// width, height, left, top</span>
    <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#scaler_width</span><span class="delimiter">'</span></span>).val(<span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#image_slicer</span><span class="delimiter">'</span></span>).width());
    <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#scaler_height</span><span class="delimiter">'</span></span>).val(<span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#image_slicer</span><span class="delimiter">'</span></span>).height());
    <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#scaler_left</span><span class="delimiter">'</span></span>).val(pos.left);
    <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#scaler_top</span><span class="delimiter">'</span></span>).val(pos.top);
  }
});
</pre></div>
</div>
 </figure></notextile></div>

<p>The result is a nice red dotted line (square) on top of the image. The dotted area is draggable and resizeable.
When the right slice is selected just hit the slice button and PHP/GD will do the rest.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="local-variable">$width</span>  = <span class="predefined">$_POST</span>[<span class="string"><span class="delimiter">'</span><span class="content">width</span><span class="delimiter">'</span></span>];
<span class="local-variable">$height</span> = <span class="predefined">$_POST</span>[<span class="string"><span class="delimiter">'</span><span class="content">height</span><span class="delimiter">'</span></span>]; 
<span class="local-variable">$left</span>   = <span class="predefined">$_POST</span>[<span class="string"><span class="delimiter">'</span><span class="content">left</span><span class="delimiter">'</span></span>];
<span class="local-variable">$top</span>    = <span class="predefined">$_POST</span>[<span class="string"><span class="delimiter">'</span><span class="content">top</span><span class="delimiter">'</span></span>];
    
<span class="comment">// read source image</span>
<span class="local-variable">$src</span> = imagecreatefromjpeg(<span class="string"><span class="delimiter">'</span><span class="content">images/sample.jpg</span><span class="delimiter">'</span></span>);
<span class="local-variable">$dest</span> = imagecreatetruecolor(<span class="local-variable">$width</span>, <span class="local-variable">$height</span>);
    
imagecopy(<span class="local-variable">$dest</span>, <span class="local-variable">$src</span>, <span class="integer">0</span>, <span class="integer">0</span>, <span class="local-variable">$left</span>, <span class="local-variable">$top</span>, <span class="local-variable">$width</span>, <span class="local-variable">$height</span>);
    
<span class="predefined">header</span>(<span class="string"><span class="delimiter">'</span><span class="content">Content-Type: image/jpeg</span><span class="delimiter">'</span></span>);
imagegif(<span class="local-variable">$dest</span>);
    
imagedestroy(<span class="local-variable">$dest</span>);
imagedestroy(<span class="local-variable">$src</span>);
</pre></div>
</div>
 </figure></notextile></div>

<p>That’s all. All files can be downloaded <a href="http://lenss.nl/images/2010/11/imageSlice.tar.gz">here</a></p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2010-11-01T17:34:11+01:00" pubdate data-updated="true">Nov 1<span>st</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/javascript/'>Javascript</a>, <a class='category' href='http://lenss.nl/tag/jquery/'>Jquery</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2010/11/jquery-php-doing-simple-image-slicing/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2010/11/just-something-funny/">Just Something Funny</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>I cam across this page today and it made me laugh :) With thanks to the <a href="http://www.gnu.org/fun/jokes/">GNU jokes archive</a>.</p>

<p>How the way people code “Hello World” varies depending on their age and job:</p>

<p><strong>High School/Jr. High</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
10 PRINT &quot;HELLO WORLD&quot;
20 END
</pre></div>
</div>
 </figure></notextile></div>

<p><strong>First year in College</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
program Hello(input, output)
 begin
 writeln('Hello World')
 end.
</pre></div>
</div>
 </figure></notextile></div>

<p>Senior year in College</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
&gt; (defun hello
 (print
 (cons 'Hello (list 'World))))
</pre></div>
</div>
 </figure></notextile></div>

<p><strong>New professional</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="preprocessor">#include</span> <span class="include">&lt;stdio.h&gt;</span>
    
<span class="directive">void</span> main(<span class="directive">void</span>)
{
  <span class="predefined-type">char</span> *message[] = {<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">World</span><span class="delimiter">&quot;</span></span>};
  <span class="predefined-type">int</span> i;
  <span class="keyword">for</span>(i = <span class="integer">0</span>; i &lt; <span class="integer">2</span>; ++i)
    printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">%s</span><span class="delimiter">&quot;</span></span>, message[i]);
    printf(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
}
</pre></div>
</div>
 </figure></notextile></div>

<p>Liquid error: Invalid id given: c++</p>

<p><strong>System Administrator</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="preprocessor">#include</span> <span class="include">&lt;stdio.h&gt;</span>
<span class="preprocessor">#include</span> <span class="include">&lt;stdlib.h&gt;</span>
main()
{
  <span class="predefined-type">char</span> *tmp;
  <span class="predefined-type">int</span> i=<span class="integer">0</span>;
      
  <span class="comment">/* on y va bourin */</span>
  tmp=(<span class="predefined-type">char</span> *)malloc(<span class="integer">1024</span>*<span class="keyword">sizeof</span>(<span class="predefined-type">char</span>));
  <span class="keyword">while</span> (tmp[i]=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Wolrd</span><span class="delimiter">&quot;</span></span>[i++]);
      
  <span class="comment">/* Ooopps y'a une infusion ! */</span>
  i=(<span class="predefined-type">int</span>)tmp[<span class="integer">8</span>];
  tmp[<span class="integer">8</span>]=tmp[<span class="integer">9</span>];
  tmp[<span class="integer">9</span>]=(<span class="predefined-type">char</span>)i;
  printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">%s</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>,tmp);
}
</pre></div>
</div>
 </figure></notextile></div>

<p><strong>Apprentice Hacker</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
#!/usr/local/bin/perl
$msg=&quot;Hello, world.\n&quot;;
if ($#ARGV &gt;= 0) {
  while(defined($arg=shift(@ARGV))) {
    $outfilename = $arg;
    open(FILE, &quot;&gt;&quot; . $outfilename) || die &quot;Can't write $arg: $!\n&quot;;
    print (FILE $msg);
    close(FILE) || die &quot;Can't close $arg: $!\n&quot;;
  }
} else {
  print ($msg);
}
1;
</pre></div>
</div>
 </figure></notextile></div>

<p><strong>Experienced Hacker</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="preprocessor">#include</span> <span class="include">&lt;stdio.h&gt;</span>
<span class="preprocessor">#include</span> <span class="include">&lt;string.h&gt;</span>
<span class="preprocessor">#define</span> S <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, World</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>
main(){exit(printf(S) == strlen(S) ? <span class="integer">0</span> : <span class="integer">1</span>);}
</pre></div>
</div>
 </figure></notextile></div>

<p><strong>Seasoned Hacker</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
     % cc -o a.out ~/src/misc/hw/hw.c
     % a.out
     Hello, world.
</pre></div>
</div>
 </figure></notextile></div>

<p><strong>Guru Hacker</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
&gt; % cat
 Hello, world.
</pre></div>
</div>
 </figure></notextile></div>

<p><strong>New Manager (do you remember?)</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
10 PRINT &quot;HELLO WORLD&quot;
20 END
</pre></div>
</div>
 </figure></notextile></div>

<p><strong>Middle Manager</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
mail -s &quot;Hello, world.&quot; bob@b12
Bob, could you please write me a program that prints &quot;Hello, world.&quot;?
I need it by tomorrow.
^D
</pre></div>
</div>
 </figure></notextile></div>

<p><strong>Senior Manager</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
% zmail jim
I need a &quot;Hello, world.&quot; program by this afternoon.
</pre></div>
</div>
 </figure></notextile></div>

<p><strong>Chief Executive</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
% letter
letter: Command not found.
% mail
To: ^X ^F ^C
% help mail
help: Command not found.
% damn!
!: Event unrecognized
% logout
</pre></div>
</div>
 </figure></notextile></div>

<p><strong>Research Scientist</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
PROGRAM HELLO
  PRINT *, 'Hello World'
  END
</pre></div>
</div>
 </figure></notextile></div>

<p><strong>Older research Scientist</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
WRITE (6, 100)
  100 FORMAT (1H ,11HHELLO WORLD)
    CALL EXIT
    END
</pre></div>
</div>
 </figure></notextile></div>

</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2010-11-01T10:32:09+01:00" pubdate data-updated="true">Nov 1<span>st</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/-home/'>/home</a>, <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2010/11/just-something-funny/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2010/09/zend-studio-goes-virtual/">Zend Studio Goes Virtual</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>Zend Studio added a new great <a href="http://www.zend.com/en/products/studio/vmware-workstation-deployment#discount">feature</a> to there already impressive stack of features. The IDE just keeps growing in the right direction. </p>

<p>So the new 8 version which at the time of writing is in Beta added VMWare support. This is a feature i was looking forward to. And couldn’t wait to give this a try. So when i got a email that the new beta is out. I didn’t wait and downloaded the behemoth.</p>

<p>Adding VMWare support to the IDE seems like a logical thing to do. Specially since everything is virtualized now a days. I thought about this a while. But you can use it in different setups. For me it is an extra on my development environment. I’m a big Linux enthusiast. But at the office i work on windows. So now i can develop in my own virtual Linux environment. But it’s also a great solution for running Unit Test on a production VM. Or just to test on a production VM.</p>

<p>My first try was on my OS of choice which is Ubuntu. That however didn’t go to well. As soon as i started the “Run as VMWare application” my IDE would die on me. I quickly gave up on this mainly because i am running Maverick which is not considered stable. And VMWare already had some problems building the kernel modules. If anybody is interested in the crash logs. I still have some.</p>

<p>So back to windows. Windows 7 in particular. I always keep a Windows partition laying around. For games and stuff. So i downloaded the following files.</p>

<blockquote>

  <ul>
    <li>Ubuntu-Server</li>
    <li>Zend Studio 8 Beta (<a href="http://www.zend.com/en/products/studio/download-8-beta">trial</a>)</li>
    <li>VMWare 7.1.2        (<a href="http://downloads.vmware.com/d/info/desktop_downloads/vmware_workstation/7_0">trial</a>)</li>
  </ul>
</blockquote>

<p>Installing VMWare and Zend Studio is a since. Nothing to make note off here. After that was done i installed Ubuntu 10.04 Server edition. And installed Zend Server inside of it. That should be all.. right? So let’s launch the IDE and give it a shot. Well it launched but i got back an error like below.</p>

<p><a href="http://lenss.nl/images/2010/09/zend-server-vm-noconnect.png"><img src="http://lenss.nl/images/2010/09/zend-server-vm-noconnect_s.jpg" alt="" /></a></p>

<p>At first i had no clue what was going on. But i had the feeling there was something wrong with the VMWare client tools. After digging through the Zend Studio manual i found the <a href="http://files.zend.com/help/Beta/Zend_Studio_8_0/zend-studio.htm#integrating_with_vmware_workstation.htm">answer</a> The ‘hgfs’ was not mounted on teh client OS. And this was because the vmware tools did not have enough libraries to build everything. To build the complete VMWare tools on the client OS we need</p>

<blockquote>

  <ul>
    <li>gcc</li>
    <li>make</li>
    <li>build-essential</li>
    <li>linux-headers-(current version)</li>
  </ul>
</blockquote>

<p>When that’s done it necessary to attach the linux version of the VMWare tools to the virtual CDRom drive. So we can mount it inside the VM.</p>

<blockquote>
  <p>/usr/lib/vmware/isoimages/linux.iso</p>
</blockquote>

<blockquote>

  <p>mount /dev/cdrom /mnt</p>
</blockquote>

<p>Copy the file somewhere and unmount the /mnt or the build will fail. Unpack the VMWare tools and run the perl script inside to install. Once that’s done follow the VMWare instructions. Or reboot the VM.</p>

<p>Now we are all set. Now it’s just a matter of writing code. And running it on the VM. When running an application as a VMWare application the IDE syncs the files with the shared folder on the VM. After that the internal browser is launched to see the result.</p>

<p>The first time you will be asked for the VM to use. Just point it to the VM image created by VMWare.</p>

<p><a href="http://lenss.nl/images/2010/09/selectvm.png"><img src="http://lenss.nl/images/2010/09/selectvm_s.jpg" alt="" /></a></p>

<p>When no VM is active when launching the application. Zend Studio will trigger VMWare to launch the VM.</p>

<p><a href="http://lenss.nl/images/2010/09/launchvm.png"><img src="http://lenss.nl/images/2010/09/launchvm_s.jpg" alt="" /></a></p>

<p>Some output in Zend Studio</p>

<p><a href="http://lenss.nl/images/2010/09/resultvm.png"><img src="http://lenss.nl/images/2010/09/resultvm_s.jpg" alt="" /></a></p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2010-09-27T13:25:17+02:00" pubdate data-updated="true">Sep 27<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>, <a class='category' href='http://lenss.nl/tag/zend/'>Zend</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2010/09/zend-studio-goes-virtual/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2010/09/drag-drop-uploads-with-xmlhttprequest2-and-php-revised/">Drag & Drop Uploads With XMLHttpRequest2 and PHP Revised</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>A while back i wrote a <a href="http://lenss.nl/2010/01/drag-drop-uploads-with-xmlhttprequest2-and-php/">post </a> where i explained how to implement the new XMLHttpRequest2 object. The main point of the post was to use <a href="https://developer.mozilla.org/en/XMLHttpRequest">sendAsBinary()</a> so we can stream file uploads from the client to the server.</p>

<p>The post i made showed some code snippets to make this possible. And the Javascript part is all fine and dandy. But last week i had an interesting mail conversation with <a href="http://braincracking.org/">Jean-Pierre Vincent</a> about the memory consumption on the server side of things.</p>

<p>The result of some testing revealed the server would need at least the amount of memory equal to the file size. For small files this is no problem. But with bigger files this becomes a problem. Although i couldn’t reproduce Jean-Pierre’s results. I wasn’t very happy with the test results.</p>

<blockquote>

  <p>Upload 2.8 MB file results in 3.1 MB memory usage
Upload 29 MB file results in 30 MB memory usage</p>
</blockquote>

<p>A bit more testing revealed that <a href="http://php.net/manual/function.file-put-contents.php">file_put_contents()</a> was the culprit. Which seems logical if you think about it. It reads the file into memory and dumps it again. Not very elegant for big files. Besides we are trying to stream files. So why should we read them completely in to memory? We shouldn’t :)</p>

<p>Jean-Pierre decided to go with the DataForm object to solve the issue. I still want to look into that. But have not found any information about. Besides that i knew the problem was on the server side. So i rewrote the receive() method to be less memory intensive. The results are considerably better then before.</p>

<blockquote>

  <p>Upload 2.8 MB file results in 0.4 MB memory usage
Upload 29 MB file results in 0.4 MB memory usage</p>
</blockquote>

<p>The memory usage was measured with <a href="http://php.net/manual/function.memory-get-peak-usage.php">memory_get_peak_usage()</a>. And the new code is posted below:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">receive</span>()
    {
        <span class="keyword">if</span> (!<span class="local-variable">$this</span>-&gt;isValid()) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="predefined-constant">Exception</span>(<span class="string"><span class="delimiter">'</span><span class="content">No file uploaded!</span><span class="delimiter">'</span></span>);
        }
                    
        <span class="local-variable">$fileReader</span> = <span class="predefined">fopen</span>(<span class="string"><span class="delimiter">'</span><span class="content">php://input</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">r</span><span class="delimiter">&quot;</span></span>);
        <span class="local-variable">$fileWriter</span> = <span class="predefined">fopen</span>(<span class="local-variable">$this</span>-&gt;_destination . <span class="local-variable">$this</span>-&gt;_fileName, <span class="string"><span class="delimiter">&quot;</span><span class="content">w+</span><span class="delimiter">&quot;</span></span>);
    
        <span class="keyword">while</span>(<span class="predefined-constant">true</span>) {
            <span class="local-variable">$buffer</span> = <span class="predefined">fgets</span>(<span class="local-variable">$fileReader</span>, <span class="integer">4096</span>);
            <span class="keyword">if</span> (<span class="predefined">strlen</span>(<span class="local-variable">$buffer</span>) == <span class="integer">0</span>) {
                <span class="predefined">fclose</span>(<span class="local-variable">$fileReader</span>);
                <span class="predefined">fclose</span>(<span class="local-variable">$fileWriter</span>);
                <span class="keyword">return</span> <span class="predefined-constant">true</span>;
            }
    
            <span class="predefined">fwrite</span>(<span class="local-variable">$fileWriter</span>, <span class="local-variable">$buffer</span>);
        }
    
        <span class="keyword">return</span> <span class="predefined-constant">false</span>;
    }
</pre></div>
</div>
 </figure></notextile></div>

</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2010-09-22T15:26:42+02:00" pubdate data-updated="true">Sep 22<span>nd</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/javascript/'>Javascript</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2010/09/drag-drop-uploads-with-xmlhttprequest2-and-php-revised/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2010/09/recursive-array-filter/">Recursive Array Filtering</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>note to self .. a nice clean way to do recursive array filters in PHP</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="local-variable">$arr</span> = <span class="predefined">array</span>(
  <span class="string"><span class="delimiter">'</span><span class="content">teSt</span><span class="delimiter">'</span></span>,
  <span class="string"><span class="delimiter">'</span><span class="content">The quick BroWn ...</span><span class="delimiter">'</span></span>,
  <span class="string"><span class="delimiter">'</span><span class="content">foO</span><span class="delimiter">'</span></span>,
  <span class="predefined">array</span>(
    <span class="string"><span class="delimiter">'</span><span class="content">Test sTring</span><span class="delimiter">'</span></span>
  )
);
    
<span class="local-variable">$filter</span> = <span class="keyword">function</span>(&amp;<span class="local-variable">$input</span>) <span class="keyword">use</span> (&amp;<span class="local-variable">$filter</span>) {
  <span class="keyword">if</span> (<span class="predefined">is_array</span>(<span class="local-variable">$input</span>)) <span class="local-variable">$input</span> = <span class="predefined">array_map</span>(<span class="local-variable">$filter</span>, <span class="local-variable">$input</span>);
  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="predefined">is_string</span>(<span class="local-variable">$input</span>)) <span class="local-variable">$input</span> = <span class="predefined">strtolower</span>(<span class="local-variable">$input</span>);
  <span class="keyword">return</span> <span class="local-variable">$input</span>;
};
    
<span class="local-variable">$filter</span>(<span class="local-variable">$arr</span>);
<span class="predefined">var_dump</span>(<span class="local-variable">$arr</span>);
</pre></div>
</div>
 </figure></notextile></div>

</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2010-09-07T00:15:26+02:00" pubdate data-updated="true">Sep 7<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2010/09/recursive-array-filter/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2010/08/php-community-spirit-t-shirt-design-competition/">PHP Community Spirit T-Shirt Design Competition</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>I entered a design for the PHP Community <a href="http://php-spirit.strutta.com/">Spirit T-Shirt Design Competition</a>. And it got approved today. It’s a simple design that uses the PHP logo colors and font. If you like it you can vote for it by following the design below.</p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2010-08-15T15:02:22+02:00" pubdate data-updated="true">Aug 15<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/design/'>Design</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2010/08/php-community-spirit-t-shirt-design-competition/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  <div class="blog-navigation">
    
      <div class="alignleft"><a class="prev" href="http://lenss.nl/page/7/">&larr; Older</a></div>
    
    
    <div class="alignright"><a class="next" href="http://lenss.nl/page/5/">Newer &rarr;</a></div>
    
  </div>
  <div class="blog-copy">
      Copyright &copy; 2013 - Thijs Lensselink -
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  </div>
</div>

	</div>
</div>

<div id="sidebar">
  
    
<div id="logo" class="sidebox">
	<div id="logo-main">lenss<span class="nl">nl</span></div>
	<div id="logo-sub"><span class="nl">Thijs Lensselink's Blog</span></div>
</div>

<div class="sidebox">
	<a href="http://www.facebook.com/thijs.lensselink#!/" class="social facebook"></a>
	<a href="https://plus.google.com/117496548747841671883" class="social google"></a>
	<a href="http://twitter.com/tlenss" class="social twitter"></a>
	<a href="http://feeds.feedburner.com/ThijsLensselinksBlog" class="social rss"></a>
	<div style="clear:both;"></div>
</div>

<div class="sidebox">
	<h1>Me</h1>
	<div class="me">
		<a href="http://internetdefenseleague.org"><img src="http://internetdefenseleague.org/images/badges/final/footer_badge.png" alt="Member of The Internet Defense League" /></a> <a href="http://www.zend.com/store/education/certification/yellow-pages.php#show-ClientCandidateID=ZEND006598"><img src="http://lenss.nl/images/php5-zce-logo-new.gif" height="58" /></a>
		<a href="http://stackoverflow.com/users/476697/tlenss">
			<img src="http://stackoverflow.com/users/flair/476697.png?theme=dark" width="208" height="58" alt="profile for tlenss at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for tlenss at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
		</a>
		<div class="gpg">
			Key ID : <a href="http://lenss.nl/6AD79CEF.asc">0x6AD79CEF</a><br/>
			FP : FB53 B9D6 D7F1 9A16 1456 4DB3 3D35 402F 6AD7 9CEF
		</div>
	</div>
</div>

<section>
  <div class="sidebox">
	<h1>Recent entries</h1>
	<ul class="linklist">
		
		<li><a href="http://lenss.nl/2013/06/php-55-released/"><span class="higlight">June, 2013</span> PHP 5.5.0 released</a></li>
		
		<li><a href="http://lenss.nl/2013/03/casting-weirdness-with-PHP/"><span class="higlight">March, 2013</span> Casting weirdness with PHP</a></li>
		
		<li><a href="http://lenss.nl/2013/02/zend-optimizer%2B-integrated-in-5.5/"><span class="higlight">February, 2013</span> Zend Optimizer+ integrated into 5.5</a></li>
		
		<li><a href="http://lenss.nl/2013/02/phpness-serious-wtf/"><span class="higlight">February, 2013</span> PHPness Serious WTF</a></li>
		
		<li><a href="http://lenss.nl/2012/11/publish-google-reader-shared-items/"><span class="higlight">November, 2012</span> Publish Google Reader shared items</a></li>
		
		<li><a href="http://lenss.nl/2012/10/long-running-php-script-and-mysql-server-gone-away/"><span class="higlight">October, 2012</span> Long running PHP script and MySQL server gone away</a></li>
		
		<li><a href="http://lenss.nl/2012/10/git-rebase-on-pull-by-default/"><span class="higlight">October, 2012</span> Git: Rebase on pull by default</a></li>
		
		<li><a href="http://lenss.nl/2012/10/workaround-ubuntu-12-04-mysterious-system-freezes/"><span class="higlight">October, 2012</span> Workaround Ubuntu 12.04 mysterious system freezes</a></li>
		
		<li><a href="http://lenss.nl/2012/09/fixing-character-replacement-in-wordpress/"><span class="higlight">September, 2012</span> Fixing character replacement in Wordpress</a></li>
		
		<li><a href="http://lenss.nl/2012/09/resize-a-vagrant-vmdk-drive/"><span class="higlight">September, 2012</span> Resize a Vagrant VMDK drive</a></li>
		
	</ul>
</div>
</section>

<div class="sidebox ad">
	<script type="text/javascript"><!--
	google_ad_client = "ca-pub-0921745317573569";
	/* nlblue_side */
	google_ad_slot = "7706621160";
	google_ad_width = 300;
	google_ad_height = 250;
	//-->
	</script>
	<script type="text/javascript"
	src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
	</script>
</div>
<div class="sidebox">
	<h1>Tags</h1>
	<ul id="tag-cloud" class="blocklist"><a href='http://lenss.nl/tag/-home' style='font-size: 116.69565217391305%'>/home(32)</a> <a href='http://lenss.nl/tag/code' style='font-size: 160.0%'>Code(115)</a> <a href='http://lenss.nl/tag/design' style='font-size: 103.1304347826087%'>Design(6)</a> <a href='http://lenss.nl/tag/freelance' style='font-size: 102.08695652173913%'>Freelance(4)</a> <a href='http://lenss.nl/tag/google' style='font-size: 101.56521739130434%'>Google(3)</a> <a href='http://lenss.nl/tag/javascript' style='font-size: 104.17391304347827%'>Javascript(8)</a> <a href='http://lenss.nl/tag/jquery' style='font-size: 101.04347826086956%'>Jquery(2)</a> <a href='http://lenss.nl/tag/magento' style='font-size: 101.04347826086956%'>Magento(2)</a> <a href='http://lenss.nl/tag/php' style='font-size: 133.91304347826087%'>PHP(65)</a> <a href='http://lenss.nl/tag/security' style='font-size: 104.17391304347827%'>Security(8)</a> <a href='http://lenss.nl/tag/sql' style='font-size: 103.1304347826087%'>SQL(6)</a> <a href='http://lenss.nl/tag/tech' style='font-size: 150.6086956521739%'>Tech(97)</a> <a href='http://lenss.nl/tag/zend' style='font-size: 104.17391304347827%'>Zend(8)</a> </ul>
	<div style="clear:both;"></div>
</div>
<section>
  <div class="sidebox">
	<h1>GitHub Repos</h1>
	
	<ul class="linklist" id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/tlenss" class="github-follow-button">Follow On GitHub</a>
  <script type="text/javascript" src="http://octophile.com/widgets.js"></script>
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = 'http://lenss.nl/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'tlenss',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="http://lenss.nl/javascripts/github.js" type="text/javascript"> </script>
</div>
</section>

<section>
  <div class="sidebox">
	<h1>Latest Tweets</h1>
	<ul class="linklist" id="tweets">
    <li class="loading"><span class="higlight">Status updating...</span></li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("tlenss", 4, false);
    });
  </script>
  <script src="http://lenss.nl/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/tlenss" class="twitter-follow-button" data-show-count="false">Follow @tlenss</a>
  
</div>
</section>


  
</div>

<a href="http://internetdefenseleague.org"><img src="http://internetdefenseleague.org/images/badges/final/banner_right.png" alt="Member of The Internet Defense League" /></a>

<footer role="contentinfo">
</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tlenss';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
