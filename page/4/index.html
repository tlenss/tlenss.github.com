
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Thijs Lensselink's Blog</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Recruiter Rant While doing our routine sprint retrospective today. We got interrupted by our office manager Wendy. An important phone call for me. &hellip;">
    
    <meta name="author" content="Thijs Lensselink">
    
    <link rel="canonical" href="http://blog.lenss.nl/page/4/">
    <link rel="shortcut icon" href="/favicon.ico">
    <link href="http://feeds.feedburner.com/ThijsLensselinksBlog" rel="alternate" title="Thijs Lensselink's Blog" type="application/atom+xml">

    <link href="/stylesheets/screen.css" rel="stylesheet">
    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet">
    <link href="/stylesheets/bootstrap-theme.min.css" rel="stylesheet">
    <link href="/stylesheets/bootstrap-responsive.css" rel="stylesheet">
    <link href="/stylesheets/font-awesome.min.css" rel="stylesheet">
    <link href="/stylesheets/lenss.css" rel="stylesheet">
    
  </head>


<body   >

    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#"><i class="fa fa-linux"></i> lenss<span class="lenssnl">.nl/blog</span></a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="http://lenss.nl" onClick="_gaq.push(['_trackEvent', 'External-Nav Links', 'Click', 'Www']);">Home</a></li>
            <li class="active"><a href="http://blog.lenss.nl/" class="lenssnl" onClick="_gaq.push(['_trackEvent', 'External-Nav Links', 'Click', 'Blog']);">Blog</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="row">

        <div class="col-sm-8">
	
          <div id="content">
	      <div class="inner">
	      <div class="blog-index">
  
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://blog.lenss.nl/2012/02/recruiter-rant/">Recruiter Rant</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>While doing our routine <a href="http://sites.google.com/site/agiledevelopmentsite/process/sprint-retrospective">sprint retrospective</a> today. We got interrupted by our office manager Wendy. An important phone call for me. Hmm… Should have known.</p>

<p>I picked up the phone. And the guy (<a href="http://www.amoriabond.com/">Amoria Bond</a>) on the other end immediately started his sales pitch. O shit another one of those nasty recruiters. So after listening to him for a few seconds i quickly interrupted him. Told him i was not interested in a new job at all. And that he was a jerk and extremely unprofessional for calling me at the office. Completely unaware (or maybe intentionally?) what impact this might have if for instance my manager picks up the phone. Besides it’s just plain rude. </p>

<p>Now don’t get me wrong. It’s not a rant for nothing. I don’t hate recruiters. And have worked with some professional ones in the past. I’ve always enjoyed communicating with linda-lotte while she was still working for <a href="http://www.recruit4it.nl/">Recruit4it</a>. And the guys at <a href="http://www.starapple.nl">Starapple</a> are OK as well. But this guy today really pissed me off with his aggressive unmannered approach. It’s a shame i didn’t catch his name while i was in rant mode. But please don’t ever call me again.</p>

<p><strong>Update:</strong></p>

<p>It seems to be some form of new tactic to call developers in the office where they work. This happened a couple of times more after this post. So this is for the next recruiter that calls me in the office. I’ll personally come over and kick your ass!!</p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      <a href="http://blog.lenss.nl/2012/02/recruiter-rant/#disqus_thread">Comments</a>
      
      








  


<time datetime="2012-02-21T23:14:03+01:00" pubdate data-updated="true">Feb 21<span>st</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='http://blog.lenss.nl/tag/-home/'>/home</a>, <a class='category' href='http://blog.lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://blog.lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://blog.lenss.nl/2012/02/wordpress-install-compromised/">Wordpress Install Compromised</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>Last week i got an email from the Dutch <a href="https://www.ncsc.nl/">NCSC</a> (Nationaal Cyber Security Centrum). Apparently one of the nodes i manage for a customer was part of a <a href="http://en.wikipedia.org/wiki/Botnet">botnet</a>. There were no further demands. They just informed me about the issue. Damn cool! Being part of a <a href="http://en.wikipedia.org/wiki/Botnet">botnet</a> however. Not so cool!</p>

<p>With the email came a small excerpt of a IRC channel log. I recognized the node. So SSH’ed into that specific node. And used <a href="http://linux.die.net/man/8/netstat">netstat</a> to check for any strange connections. A connection on port 20 to the C&amp;C; node of the <a href="http://en.wikipedia.org/wiki/Botnet">botnet</a>. Thats not good.</p>

<blockquote><p>$ netstat -an<br />Active Internet connections (servers and established)<br />Proto Recv-Q Send-Q Local Address           Foreign Address         State<br />tcp        0      0 xxx.xxx.xxx.xx:20       69.162.80.62:20         ESTABLISHED</p></blockquote>

<p>In the email from NCSC it was mentioned to look for files called <strong>wp-rss3.php</strong>. But a search for this file did not return any hits. Hmmm. And i still  had no idea which site it concerned. Since a couple were running on this particular node. The only thing certain. It’s <a href="http://wordpress.org">Wordpress</a> related. So i started searching for recent <a href="http://wordpress.org">Wordpress</a> compromises. And found a lot of hits on Google for the <a href="http://code.google.com/p/timthumb/">timThumb</a> and <a href="http://code.google.com/p/wps3slider/">wps3slider</a> plugins. But checking the log files for these plugins revealed nothing. And for some weird reason i just cleaned up the log partition a couple of days before. So not much luck there.</p>

<p>Some more Googling <a href="http://markmaunder.com/2011/08/01/zero-day-vulnerability-in-many-wordpress-themes/">told</a> me to do a search on the Wordpress installs for the PHP function <a href="http://php.net/manual/en/function.base64-decode.php">base64_decode()</a>. O well. Lets give it a try. Some suspicious files did show up instantly.</p>

<blockquote><p>$ find . -type f -exec grep -l &#8216;base64_decode&#8217; {} \;</p></blockquote>

<p>./uploads/2010/06/wp-rss4.php <a href="http://pastebin.com/rWD1Tfxk">source</a></p>

<p>./uploads/2011/05/alienee.php <a href="http://pastebin.com/LwDaSFUK">source</a></p>

<p>./plugins/wps3slider/temp/34e3a3a74f6e2d0f236bdd3ba70c0c03.php <a href="http://pastebin.com/fG6pDWC2">source</a></p>

<p>./plugins/wps3slider/temp/cf2cdb3ad3249b9692de07290f16f287.php <a href="http://pastebin.com/pRSwG7Ud">encoded</a> <a href="http://pastebin.com/0qQ3Qeut">decoded</a></p>

<p>./plugins/wps3slider/temp/771b821c974131c67e34c83d8d2db725.php <a href="http://pastebin.com/KUP8xBEQ">encoded</a> <a href="http://pastebin.com/Z77iMH1X">decoded</a></p>

<p>./plugins/wps3slider/temp/2b3753ea4769084f2e571737b695b03a.php <a href="http://pastebin.com/RLgsTerk">encoded</a> <a href="http://pastebin.com/KwgqCS8R">decoded</a></p>

<p>./plugins/wps3slider/temp/7228f168d9692eafeafc54dbc3a1ab49.php <a href="http://pastebin.com/HeE3PdnJ">encoded</a> <a href="http://pastebin.com/FzCqSfg6">decoded</a></p>

<p>./plugins/wps3slider/uploads/1.php <a href="http://pastebin.com/YJ17ygSL">source</a></p>

<p>/var/tmp/dc.pl <a href="http://pastebin.com/YTusrVZk">encoded</a> <a href="http://pastebin.com/0WfqZt0R">decoded</a></p>

<p>Interesting. A quick look at the files showed that most of them were obfuscated. But not all. Two of the files were IRC bots written in <a href="http://www.php.net/">PHP</a>. At this moment i couldn’t resist but crack a little smile. But its also a reminder of how fragile the web really is. I quickly moved the files out of the way. And rebooted the machine. When it  came back online i monitored all connections for a while. But the connection to the C&amp;C; node was not restored. So i informed NCSC. And went back to bed!</p>

<p>The Wordpress admin should have kept the sites up to date. Lesson learned i hope! of course i could not resist to come back to it later. And so i did. I started by searching the Apache log files for <strong>wp-rss4.php</strong>. And found a couple of instances where this file was directly called. From a total of 4 different IP addresses.</p>

<blockquote>
  <p>69.162.80.62</p>
</blockquote>

<p>This is the IP address of the C&amp;C; server.</p>

<blockquote><p>186.241.16.25<br />201.8.237.18<br />201.8.226.109</p></blockquote>

<p>These IP addresses are all originating from Brasil. No further information is available at this moment. After that i started poking around the trojans / IRC bots found earlier. And as mentioned earlier. There were two bots installed on the server, One was running. The other wasn’t. This is configuration snippet from both bots.</p>

<p>The first bot. And the one i was informed about.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
var $config = array(&quot;server&quot;=&gt;&quot;antesedepois.servegame.com&quot;,^M
  &quot;port&quot;=&gt;20,^M
  &quot;pass&quot;=&gt;&quot;depois&quot;,^M
  &quot;prefix&quot;=&gt;&quot;depois&quot;,^M
  &quot;maxrand&quot;=&gt;8,^M
  &quot;chan&quot;=&gt;&quot;#depoiswp&quot;,^M
  &quot;key&quot;=&gt;&quot;&quot;,^M
  &quot;modes&quot;=&gt;&quot;+iB-x&quot;,^M
  &quot;password&quot;=&gt;&quot;depois&quot;,^M
  &quot;trigger&quot;=&gt;&quot;.&quot;,^M
  &quot;hostauth&quot;=&gt;&quot;*&quot; // * for any hostname^M
);
</pre></div>
</div>
 </figure></notextile></div>

<p>And the second one</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
var $config = array(&quot;server&quot;=&gt;&quot;58.225.75.155&quot;,
  &quot;port&quot;=&gt;9999,
  &quot;pass&quot;=&gt;&quot;&quot;,
  &quot;prefix&quot;=&gt;&quot;animal&quot;,
  &quot;maxrand&quot;=&gt;8,
  &quot;chan&quot;=&gt;&quot;#animal&quot;,
  &quot;key&quot;=&gt;&quot;&quot;,
  &quot;modes&quot;=&gt;&quot;+iB-x&quot;,
  &quot;password&quot;=&gt;&quot;oishi&quot;,
  &quot;trigger&quot;=&gt;&quot;.&quot;,
  &quot;hostauth&quot;=&gt;&quot;*!*@The.Black.Cat&quot; // * for any hostname
);
</pre></div>
</div>
 </figure></notextile></div>

<p>Notice the <strong>^M</strong> characters at the end. Seems like somebody is using windows. So now we have login details for two C&amp;C; servers. Why not take a look. </p>

<blockquote>

  <ul>
    <li>$ ircii </li>
    <li>/server antesedepois.servegame.com:20</li>
  </ul>
</blockquote>

<p>Some standard IRC stuff</p>

<blockquote><p>*** Connecting to port 20 of server antesedepois.servegame.com<br />*** Welcome to the Internet Relay Chat Network, root (from IRCPRIVATE)<br />*** /etc/irc/script/local V0.5 for Debian finished. Welcome to ircII.<br />*** If you have not already done so, please read the new user information with /HELP NEWUSER<br />*** Your host is IRCPRIVATE, running version 1.2.1546<br />*** This server was created jan 27 2012 at 06: 29:02 HodB (Serial # 00-00-00)<br />*** channel modes available abdefghijklmnopqrstuvwxyzACEFIKLMOPT<br />*** IRCX <br />*** There are 6 users and 362 invisible on 1 servers<br />*** 7 channels have been formed<br />*** This server has 368 clients and 0 servers connected<br />*** Current local users:  368  Max: 989<br />*** Current global users:  368  Max: 989<br />*** MOTD Not Present</p></blockquote>

<p>So let’s check the channels on this thing</p>

<blockquote>
  <p>/list</p>
</blockquote>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
*** Channel    Users  Topic
*** #depoiswp  360    Entrou = Ban :)
*** #grmteam   6      
*** #depoisSca 4      Entrou = Ban :)
*** #depoisSca 4      Entrou = Ban :)
*** #depoisVul 6      Entrou = Ban :)
*** #rfi       3      
*** #sql       1  
</pre></div>
</div>
 </figure></notextile></div>

<p>I entered all of the channels and waited for a while. But no activity took place. The only really interested channel is #depoiswp. This is the channel where all the bots connect. At the time i logged in there were about 360 of them  available. I immediately recognized the log excerpt send to me by the NCSC.</p>

<blockquote><p>*** Topic for #depoiswp: Entrou = Ban :)<br />*** #depoiswp SYSTEM 1327945185<br />(#depoiswp/#depoiswp) Entrou = Ban :)<br />*** [A]depois88802849 (~depois48170648@68.233.238.XX) has joined channel #depoiswp<br />*** #depoiswp 1327653297<br />*** [A]depois13436992 (~depois92951214@212.227.114.XX) has joined channel #depoiswp<br />*** [A]depois18833547 (~depois69088341@184.154.130.XX) has joined channel #depoiswp<br />*** [A]depois80116634 (~depois13242297@213.251.189.XXX) has joined channel #depoiswp<br />*** [A]depois31855907 (~depois23946193@82.85.28.XXX) has joined channel #depoiswp<br />*** [A]depois25458508 (~depois64120008@87.106.214.XX) has joined channel #depoiswp<br />*** [A]depois17803105 (~depois55004207@74.208.16.XX) has joined channel #depoiswp<br />*** [A]depois96800217 (~depois89042073@174.121.216.XXX) has joined channel #depoiswp<br />*** [A]depois17108432 (~depois51961332@209.68.1.XXX) has joined channel #depoiswp<br />*** [A]depois95432403 (~depois13925479@209.68.1.XXX) has joined channel #depoiswp<br />*** [A]depois96515275 (~depois10767943@195.74.38.XXX) has joined channel #depoiswp<br />*** [A]depois73596561 (~depois90562179@69.89.31.XXX) has joined channel #depoiswp<br />*** [A]depois85357227 (~depois31697723@64.191.115.XX) has joined channel #depoiswp<br />*** [A]depois07993697 (~depois40240585@79.96.128.XX) has joined channel #depoiswp<br />*** [A]depois97441253 (~depois19633359@193.189.74.XX) has joined channel #depoiswp<br />*** [A]depois76843389 (~depois55419325@176.9.34.XXX) has joined channel #depoiswp<br />*** [I]depois16679788 (~depois28004829@213.171.218.XXX) has joined channel #depoiswp<br />*** [A]depois88178285 (~depois05296405@74.220.215.XXX) has joined channel #depoiswp</p></blockquote>

<blockquote><p>&lt;[A]depois16231776&gt; [Attack Finalizado!]: 1749605 MB enviados / Pacotes enviados: 14580 MB/s <br />&lt;[I]depois60130568&gt; [Attack Finalizado!]: 75 MB enviados / Pacotes enviados: 1 MB/s <br />&lt;[I]depois48664304&gt; [Attack Finalizado!]: 75 MB enviados / Pacotes enviados: 1 MB/s <br />&lt;[I]depois65415449&gt; [Attack Finalizado!]: 75 MB enviados / Pacotes enviados: 1 MB/s <br />&lt;[I]depois11325010&gt; [Attack Finalizado!]: 75 MB enviados / Pacotes enviados: 1 MB/s <br />*** [A]depois40994506 (~depois72760562@79.98.28.XX) has joined channel #depoiswp<br />&lt;[A]depois07568398&gt; [Attack Finalizado!]: 2187317 MB enviados / Pacotes enviados: 18228 MB/s <br />&lt;[A]depois55402758&gt; [Attack Finalizado!]: 11425 MB enviados / Pacotes enviados: 95 MB/s <br />*** [A]depois03383512 (~depois52457929@74.220.215.XX) has joined channel #depoiswp<br />&lt;[A]depois37064023&gt; [Attack Finalizado!]: 1264043 MB enviados / Pacotes enviados: 10534 MB/s <br />&lt;[A]depois69234369&gt; [Attack Finalizado!]: 2205504 MB enviados / Pacotes enviados: 18379 MB/s <br />*** [A]depois74911768 (~depois04730096@74.220.215.XX) has joined channel #depoiswp<br />*** Signoff: [A]depois31575043 (Connection reset by peer)<br />&lt;[I]depois17710498&gt; [Attack Finalizado!]: 81 MB enviados / Pacotes enviados: 1 MB/s <br />&lt;[I]depois28464134&gt; [Attack Finalizado!]: 81 MB enviados / Pacotes enviados: 1 MB/s</p></blockquote>

<p>Thats fine and all. I disconnected shortly after that. I really have no reason  to be poking around there now do i ;) Besides who want to  interfere with an ongoing investigation. So poking around the files a bit more didnot  reveal  all that information.Except for the fact that besides a IRC bot a backdoor was also installed in the form of a perl script dc.pl installed in /var/tmp. So who knows. The server might be rooted at this point.</p>

<p>I spend some more time on decoding the bot and trojan contents. And posted them on pastebin if you are interested. The server is going to be  decommissioned soon. So i am not going to pay much more attention to it.</p>

<blockquote>
  <p>1.php and b2dabd0e2c42b55fabf741bcac29f857.php</p>
</blockquote>

<p>Web Shell by boff</p>

<blockquote>
  <p>2b3753ea4769084f2e571737b695b03a.php</p>
</blockquote>

<p>This file was base64 encoded but once decoded reveled to be a simple script by v0pCr3w and nob0dyCr3w to run system commands on the server. Also included was a simple upload form.</p>

<blockquote>
  <p>34e3a3a74f6e2d0f236bdd3ba70c0c03.php</p>
</blockquote>

<p>c99 injector v1</p>

<blockquote>
  <p>771b821c974131c67e34c83d8d2db725.php</p>
</blockquote>

<p>This script was rot13 and base64 encoded and was trying to cleanup after the hacker. And install a second back door.</p>

<blockquote>
  <p>7228f168d9692eafeafc54dbc3a1ab49.php and cce0a37ffc138a8908da05977639bed1.php</p>
</blockquote>

<p>Again rot13 and base64 encoded.But this script contained something that looks like a control panel. The page title was ‘Hacked by Sherif #oishi @ ALLnet’</p>

<blockquote>
  <p>alienee.php</p>
</blockquote>

<p>Still working on this one</p>

<blockquote>
  <p>cf2cdb3ad3249b9692de07290f16f287.php and ded3244749701c4eb5a29b959ad56736.php</p>
</blockquote>

<p>These files contained a second bot that was connecting to a whole different server. Probably exploited by another crew?</p>

<blockquote>
  <p>dc.pl</p>
</blockquote>

<p>This Perl backdoor was created by one  of the IRC bot scripts. And was hiding in /var/tmp after creation.</p>

<ul>
  <li>And some links i found useful while working on this issue.</li>
  <li><a href="http://eromang.zataz.com/2012/01/08/gangbang-mytijn-org-malware-spreader-down/">http://eromang.zataz.com/2012/01/08/gangbang-mytijn-org-malware-spreader-down/</a></li>
  <li><a href="http://www.madirish.net/content/hookworm-stealth-php-backdoor">http://www.madirish.net/content/hookworm-stealth-php-backdoor</a></li>
  <li><a href="http://markmaunder.com/2011/08/01/zero-day-vulnerability-in-many-wordpress-themes/">http://markmaunder.com/2011/08/01/zero-day-vulnerability-in-many-wordpress-themes/</a></li>
</ul>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      <a href="http://blog.lenss.nl/2012/02/wordpress-install-compromised/#disqus_thread">Comments</a>
      
      








  


<time datetime="2012-02-06T22:37:10+01:00" pubdate data-updated="true">Feb 6<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='http://blog.lenss.nl/tag/-home/'>/home</a>, <a class='category' href='http://blog.lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://blog.lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://blog.lenss.nl/tag/security/'>Security</a>, <a class='category' href='http://blog.lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://blog.lenss.nl/2012/02/php-critical-bug-cve-2012-0830/">PHP Critical Bug CVE-2012-0830</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>Ok it’s a bit late But i have been laying under a rock for the last week. And i guess it can’t hurt!</p>

<p>Last week a critical bug was discovered in PHP. Which affects versions 5.3.9 and 5.2.17. The bug could be exploited to run arbitrary code on a remote PHP system. So upgrade your systems. And of course Stefan Esser <a href="http://news.php.net/php.internals/57655">popped up</a> with some wise words :)… O well i still think the guy does great work.</p>

<p>More info about the issue can be found on packetstorm (<a href="http://packetstormsecurity.org/files/cve/CVE-2012-0830">CVE-2012-0830</a>) </p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      <a href="http://blog.lenss.nl/2012/02/php-critical-bug-cve-2012-0830/#disqus_thread">Comments</a>
      
      








  


<time datetime="2012-02-05T13:39:43+01:00" pubdate data-updated="true">Feb 5<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='http://blog.lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://blog.lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://blog.lenss.nl/tag/security/'>Security</a>, <a class='category' href='http://blog.lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://blog.lenss.nl/2011/11/php-getting-strict-sessions/">PHP Getting Strict Sessions</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>For years <a href="http://php.net/">PHP</a> has been vulnerable to session adoption which can enable <a href="http://en.wikipedia.org/wiki/Session_fixation">session fixation</a>. And since sessions are a major part of web applications now a days. A lot of platforms are open and waiting for an attack to happen.</p>

<p><strong>session adoption &amp; session fixation</strong></p>

<p>The problem exists because the current session module does not validate the session id that comes in from a cookie. This means uninitialized session id’s can be passed by the client. This happens due to the fact that browsers overwrite cookie if multiple cookies are send per request.
Some people would say this is solvable by implementing <a href="http://nl3.php.net/manual/en/function.session-regenerate-id.php">session_regenerate_id()</a>. But this is not the case.</p>

<p>Because session fixation can be used to take over control of web applications. Validation is required when multiple cookies are send per request. When multiple cookie are send with a request. Browsers send multiple cookies without domain / path information. This way it’s impossible to tell which cookie belongs to which domain. </p>

<p><strong>So how do we fix this?</strong></p>

<p>There is some userland code that does offer the ability to validate session data. But this has not been widely adopted by other developers.</p>

<p>Code that adds the session ID as a validation key:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
session_destory();
session_regenerate_id();
<span class="predefined">$_SESSION</span>[<span class="string"><span class="delimiter">'</span><span class="content">valid_id</span><span class="delimiter">'</span></span>] = session_id(); 
</pre></div>
</div>
 </figure></notextile></div>

<p>And the code to check if the session was properly initialized:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">if</span> (<span class="predefined">$_SESSION</span>[<span class="string"><span class="delimiter">'</span><span class="content">valid_id</span><span class="delimiter">'</span></span>] !== session_id()) {
  <span class="predefined">die</span>(<span class="string"><span class="delimiter">'</span><span class="content">Invalid use of session ID</span><span class="delimiter">'</span></span>);
}
</pre></div>
</div>
 </figure></notextile></div>

<p>Thank god the internal developer know this. And are working to fix this. For the past days there has been an interesting discussion going on on the <a href="http://news.php.net/php.internals">internals</a> list. About applying a patch that will fix this. The patch will add some new php.ini features and a new method validate_id() for the session save handler. Hopefully this will be available in version 5.4.</p>

<p>To not break BC strict_mode will be disabled by default. But can be enabled by setting the following setting in php.ini. When enabled uninitialized session ID will be discarded.</p>

<blockquote>
  <p>session.use_strict_mode=0</p>
</blockquote>

<p>To prevent a DoS instead of session fixation. An new feature has been added that deletes possible malicious cookies that prevent new session ID.</p>

<blockquote>
  <p>session.safe_session_cookie=1</p>
</blockquote>

<p>You can read more about session fixation and the upcoming patch on the <a href="https://wiki.php.net/rfc/strict_sessions">PHP-Wiki</a></p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      <a href="http://blog.lenss.nl/2011/11/php-getting-strict-sessions/#disqus_thread">Comments</a>
      
      








  


<time datetime="2011-11-30T15:38:28+01:00" pubdate data-updated="true">Nov 30<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://blog.lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://blog.lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://blog.lenss.nl/tag/security/'>Security</a>, <a class='category' href='http://blog.lenss.nl/tag/tech/'>Tech</a>, <a class='category' href='http://blog.lenss.nl/tag/zend/'>Zend</a>
  
</span>


    </p>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://blog.lenss.nl/2011/11/abbywinters-com-is-hiring/">Abbywinters.com Is Hiring!</a></h1>
	
	</header>
</header>


  <div class="articletext"><p><img class="left" src="http://blog.lenss.nl/images/2011/11/aw-logo-roundel-blue.png" />
If you’re looking for a new challenging and exiting Senior Webdeveloper position. Don’t look any further. If you already think you have the job of your dreams. Think again!</p>

<p><em><a href="http://www.abbywinters.com">abbywinters.com</a> <strong>(NSFW)</strong> is one of the largest and most ethical, highly rated, well designed, and successful erotic websites in the world today. abbywinters.com is the WINNER of the AVN 2011 Awards for Best Membership site!</em></p>

<p>And we are looking to hire a new talented webdeveloper to expand our small team. What would you think about joining our small Agile team of highly qualified professionals? </p>

<p>You will be creating sexy, exiting and game changing experiences for the web, work for one of the industry leaders. And just be part of an awesome company. Some of the jobs key elements are:</p>

<ul>
  <li>
    <p>Implementing development projects</p>
  </li>
  <li>
    <p>Leading informal mentoring during day-to-day work</p>
  </li>
  <li>
    <p>Contribute to design of development projects</p>
  </li>
  <li>
    <p>Track, reduce, and prevent technical debt in Web Development projects</p>
  </li>
</ul>

<blockquote>
  <p>Motivated by principles of social responsibility, we deliver provocative media by embracing imagination, creativity and emerging technologies. Our models, customers and business partners are inspired by our fervid passion.</p>

</blockquote>

<blockquote>

  <p>Our experienced staff use state-of-the-art content production facilities to produce 10 shoots a week from concept to finished art, utilizing the most advanced digital capture, post production and delivery systems in the world.</p>

</blockquote>

<blockquote>

  <p>You will be working directly with our Web Dev Manager, Lead developer and colleagues in the web dev team. We need each individual to contribute for us to continue as a pioneer in our industry.</p>
</blockquote>

<p>If you posses a “Can do” attitude. Would like to work in the center of Amsterdam. And are able to identify your self in the criteria below. You might want to head over to our <a href="http://careers.abbywinters.com/job-opportunities/senior-php-developer/">career portal</a> for a more detailed description.  </p>

<p><strong>Technical competencies – Required</strong></p>

<ul>
  <li>
    <p>High level of skill with PHP 5</p>
  </li>
  <li>
    <p>High level of skill with Object Oriented Programming</p>
  </li>
  <li>
    <p>High level of skill with HTML/CSS</p>
  </li>
  <li>
    <p>High level of skill with JavaScript</p>
  </li>
  <li>
    <p>High level of skill with Internet Applications</p>
  </li>
  <li>
    <p>Moderate level of skill with Unit Testing and Test Driven Design</p>
  </li>
  <li>
    <p>Moderate level of skill with MySQL</p>
  </li>
  <li>
    <p>Moderate level of skill with Windows XP operating system</p>
  </li>
  <li>
    <p>Experience with the GNU/Linux operating system</p>
  </li>
  <li>
    <p>Competent with Revision Control systems (Subversion)</p>
  </li>
  <li>
    <p>Bachelor of Science in Computer Science, or equivalent experience</p>
  </li>
  <li>
    <p>Zend Certified Engineer, or equivalent experience</p>
  </li>
  <li>
    <p>At least 5 years experience in Web Application Development</p>
  </li>
</ul>

<p><strong>Technical competencies – Desired</strong></p>

<ul>
  <li>
    <p>Moderate level of skill with the Apache HTTP server</p>
  </li>
  <li>
    <p>Good understanding of the Model-View-Controller pattern</p>
  </li>
  <li>
    <p>Good understanding of the ActiveRecord Object-Relational-Mapping pattern</p>
  </li>
  <li>
    <p>Familiarity with Agile software development practices (Scrum)</p>
  </li>
  <li>
    <p>E-commerce</p>
  </li>
  <li>
    <p>Agile development experience</p>
  </li>
</ul>

</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      <a href="http://blog.lenss.nl/2011/11/abbywinters-com-is-hiring/#disqus_thread">Comments</a>
      
      








  


<time datetime="2011-11-22T14:46:51+01:00" pubdate data-updated="true">Nov 22<span>nd</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://blog.lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://blog.lenss.nl/tag/javascript/'>Javascript</a>, <a class='category' href='http://blog.lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://blog.lenss.nl/tag/sql/'>SQL</a>, <a class='category' href='http://blog.lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://blog.lenss.nl/2011/11/ubuntu-11-10-issues-after-fresh-install/">Ubuntu 11.10 Issues After Fresh Install</a></h1>
	
	</header>
</header>


  <div class="articletext"><p><strong>Update: 13-11-2011</strong></p>

<p>I decided to give Ubuntu another try. After downloading and burning a fresh image. I did a clean install. And this time the result was a lot better then the first time. Maybe i just had a bad disk.</p>

<p>Unity still caused me issues. Mainly because i am running a dual monitor setup. And i wan to use a TwinView setup. This just does not seem to work at the moment. So i install GNOME Shell. And that seems to work a lot smoother with two screens. Even my sound issues have been resolved magically. Maybe i should stick with Ubuntu a bit longer.</p>

<p><del>This weekend i decided to finally try to upgrade Ubuntu to the latest version (11.10). And since the upgrade process was not working out for me. I had no other choice but to do a clean install. No problem. It was time for a clean install anyway.</del></p>

<p><del>After fighting my way through a pile of bad rewritable DVDs i finally managed to write to disc that didn’t halt in the middle of the install process. And finished the install quite quickly. No problem there.</del></p>

<p><del>The <a href="https://launchpad.net/lightdm">Lightgdm</a> greeting instead of the old <a href="http://projects.gnome.org/gdm/">GDM</a> interface was nice. I logged in. And then it hit me. O shit they hooked Ubuntu up with the <a href="http://unity.ubuntu.com/">Unity</a> interface. The last time i upgraded Ubuntu that was the first thing i disabled. But my second screen wasn’t activated. So i decided to install the Nvidia drivers first. And then did a reboot.</del></p>

<p><del>After the system came back up. The desktop environment didn’t load anymore. And if i waited long enough the whole system would crawl to a halt. Damn! At this point i was getting sleepy. And didn’t want to spend the whole night poking around the system trying to fix this. So a bit of Google magic later i found <a href="http://blog.al4.co.nz/2011/10/slow-desktop-performance-on-ubuntu-11-10-with-nvidia-graphics-cards/">this</a>. Some issues related to the current Nvidia driver. So i upgraded to the 285.05 version</del></p>

<p><del></del></p>

<blockquote>
  <p>$ sudo bash
$ add-apt-repository ppa:ubuntu-x-swat/x-updates
$ apt-get update &amp;&amp; apt-get upgrade
$ reboot</p>
</blockquote>

<p>&lt;/del&gt;</p>

<p><del>And after a reboot the desktop was fine again. Nice!</del></p>

<p><strong>World of Warcraft</strong></p>

<p>After that i installed wine and copied back the old files i already had installed previously. But World of Warcraft didn’t want to start anymore. And although i planned not to play for a while. This got me poking around. And of course couldn’t find a solution. So i downloaded a new game client from battle.net. And started a fresh install. But when the launcher came up. It crashed just like before. Tried it a couple more times. When i noticed it was crashing starting the download. SO i started poking around in the download settings. And disabled peer-to peer. And voila! It started working for me again.</p>

<blockquote>
  <p>Options &gt; Downloader Preferences 
(uncheck ¨Enable peer-to-peer Transfer¨)</p>
</blockquote>

<p><del><strong>Lets remove Unity!</strong></del></p>

<p><del>Although i kind alike the <a href="http://unity.ubuntu.com/">Unity</a> interface. It wasn’t running smoothly. And i was having some serious CPU load issues. So i decided to remove it once again. This time. It wasn’t as easy though. I followed the steps in <a href="http://linux-software-news-tutorials.blogspot.com/2011/10/ubuntu-1110-oneiric-remove-unity-and.html">this</a> post. Only to come to the realization that its <a href="http://www.gnome.org/gnome-3/">Gnome 3</a> i´m dealing with and not Gnome2. O well lets give it a try. </del></p>

<p><del>So after messing with the themes a bit. I got the normal look back. Now the only thing annoying left is the bottom bar. That has to go. And preferably moved to the second screen. This was surprisingly easy for a change. Start up DConfig Editor from the Applications menu. And navigate to.</del></p>

<p><del></del></p>

<blockquote>
  <p>org &gt; gnome &gt; gnome-panel &gt; layout &gt; toplevels</p>
</blockquote>

<p>&lt;/del&gt;</p>

<p><del>(then change)</del></p>

<blockquote>
  <p>monitor : 1
orientation : top</p>
</blockquote>

<p>&lt;/del&gt;</p>

<p><del>And fix the freaking <a href="http://askubuntu.com/questions/69306/tilde-and-double-quote-keys-dont-work-on-the-command-line">keyboard</a></del></p>

<p><del>Sound still makes a crackling noise!</del></p>

<p><del>But at least i have a desktop that looks reasonably the same as my old and trusted Gnome2 one did. </del></p>

<p><a href="http://blog.lenss.nl/images/2011/11/Screenshot-at-2011-11-06-231619.png"><img src="http://blog.lenss.nl/images/2011/11/Screenshot-at-2011-11-06-231619-300x93.png" alt="" /></a></p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      <a href="http://blog.lenss.nl/2011/11/ubuntu-11-10-issues-after-fresh-install/#disqus_thread">Comments</a>
      
      








  


<time datetime="2011-11-07T00:26:27+01:00" pubdate data-updated="true">Nov 7<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://blog.lenss.nl/tag/-home/'>/home</a>, <a class='category' href='http://blog.lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://blog.lenss.nl/2011/10/lack-of-better-content/">Lack of Better Content</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>Just something funny for a change ;)</p>

<p><a href="http://blog.lenss.nl/images/2011/10/Screenshot.png"><img src="http://blog.lenss.nl/images/2011/10/Screenshot-300x235.png" alt="" /></a></p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      <a href="http://blog.lenss.nl/2011/10/lack-of-better-content/#disqus_thread">Comments</a>
      
      








  


<time datetime="2011-10-08T12:58:14+02:00" pubdate data-updated="true">Oct 8<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://blog.lenss.nl/tag/-home/'>/home</a>
  
</span>


    </p>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://blog.lenss.nl/2011/09/the-current-state-of-ssl-and-the-future-of-authenticity/">The Current State of SSL and the Future of Authenticity</a></h1>
	
	</header>
</header>


  <div class="articletext"><p><img class="left" src="http://blog.lenss.nl/images/2011/09/convergence.png" />
Last week i had a blast while listening to <a href="http://www.thoughtcrime.org/">Moxie Marlinspike&#8217;s</a> Blackhat talk <a href="http://www.youtube.com/watch?v=Z7Wl2FW2TcA">the past and future of SSL</a>. The video is an absolute must see if you have any concern about the current state of SSL or the whole web for that matter.</p>

<p>As many know. There has been quite the turmoil in the SSL world lately with some big CA&#8217;s (<a href="http://www.comodo.com">Comodo</a>, <a href="http://www.startcom.org/">StartCom</a>, <a href="http://www.diginotar.com/">Diginotar</a>, <a href="http://www.globalsign.com/">GlobalSign</a>) getting hacked. And rogue certificates being generated for major domains like microsoft.com, google.com, etc for who knows what type of malicious purpose. The real problem here are the centralized CA&#8217;s. For SSL to work you need to explicitly trust the major CA&#8217;s. And if one gets hacked. Well.. we know the deal by now. And the funny thing is that Moxie mentions in his talk. The whole CA wasn&#8217;t even part of the original SSL protocol. As the creator of SSL said &#8220;It&#8217;s something we through in at the end&#8221;.</p>

<p>But instead of only bashing the CA&#8217;s. Moxie comes with a solution to the problem. In the form of a new protocol <a href="http://convergence.io/">Convergence</a>, Which exists of a client and a server package. The client right now is a simple Firefox extension. And when installed it disables the current CA system in the browser. And will use one or more of the selected notaries instead. It even works with self signed certificates. And the back-end is a modular one. And the standard CA verification can be swapped with for instance <a href="http://www.dnssec.net/">DNSSEC</a> based verification.</p>

<p>There is still a level of trust involved. But you won&#8217;t lay all your trust in one specific CA. Convergence uses notaries. Notaries are anonymous nodes that can be picked at will and can be used to verify the requested certificate. And like i said the notaries are anonymous. No more browser leakage at this point. One of th notaries will act as a bounce node to which a SSL connection is made. All other notaries are contacted through this secure connection.</p>

<p>I am probably not the best person to explain this all. So go ahead and listen/watch <a href="http://www.youtube.com/watch?v=Z7Wl2FW2TcA">Moxie&#8217;s talk</a> and form your own opinion. But i think everybody should install <a href="http://convergence.io/">this</a> Firefox plugin. And forget about the whole CA system. I went ahead and installed a notary node myself. Which can be found <a href="http://lenss.nl/lenssnl.notary">here</a>. More information about setting up a notary node yourself can be found <a href="https://github.com/moxie0/Convergence/wiki/Running-a-Notary">here</a></p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      <a href="http://blog.lenss.nl/2011/09/the-current-state-of-ssl-and-the-future-of-authenticity/#disqus_thread">Comments</a>
      
      








  


<time datetime="2011-09-12T02:13:33+02:00" pubdate data-updated="true">Sep 12<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://blog.lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://blog.lenss.nl/tag/security/'>Security</a>, <a class='category' href='http://blog.lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://blog.lenss.nl/2011/09/php-slow-on-32-bit-ubuntu/">PHP Slow on 32-bit Ubuntu</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>My last <a href="http://lenss.nl/2011/08/php5-filesize-limit-on-32-bit-system/">post</a> was about the 32-bit integer issue i was having with PHP. And besides setting up a 64-bit server one of the solutions is to compile PHP with the CFLAGS mentioned in my previous post. </p>

<p>Intrigued by the fact that my 32-bit Ubuntu installation did not suffer from the same issue. I started to read the PHP5 changelog for Ubuntu.</p>

<blockquote>

  <p>CFLAGS=”-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64″ ./configure</p>
</blockquote>

<p>But this has a negative side effect. Namely PHP running 50% slower then it should be. And to my surprise Ubuntu applies the CFLAGS above when compiling PHP5 for a 32-bit platform. So that would mean PHP on Ubuntu is always running 50% slower? Well according to <a href="https://bugs.php.net/bug.php?id=45942">this</a> is should be the case. </p>

<p>I downloaded <a href="http://nl.php.net/get/php-5.3.8.tar.gz/from/a/mirror">php-5.3.8</a> from php.net and compiled two versions. One with the CFLAGS set for large files. And one normal without any changes. After that i downloaded the benchmark script from <a href="http://www.php-benchmark-script.com">php-benchmark-script.com</a>. And did a couple of runs on each of the two installs. The results are stunning.</p>

<p><strong>PHP-5.3.8 compiled with large file support:</strong></p>

<blockquote>
  <ul>
    <li>test_math                 : 4.414 sec.</li>
    <li>test_stringmanipulation   : 4.968 sec.</li>
    <li>test_loops                : 3.529 sec.</li>
    <li>test_ifelse               : 2.344 sec.</li>
    <li>
      <hr />
    </li>
    <li>Total time:               : 15.255 sec.</li>
  </ul>
</blockquote>

<p><strong>PHP-5.3.8 compiled without large file support:</strong></p>

<blockquote>
  <ul>
    <li>test_math                 : 2.274 sec.</li>
    <li>test_stringmanipulation   : 2.286 sec.</li>
    <li>test_loops                : 1.619 sec.</li>
    <li>test_ifelse               : 1.228 sec.</li>
    <li>
      <hr />
    </li>
    <li>Total time:               : 7.407 sec.</li>
  </ul>
</blockquote>

<p>That’s pretty much a 50% speed decrease. One more thing i tried is adding the ‘AC_SYS_LARGEFILE’ macro to configure.in and rebuild the configure script. But this had no effect at all.</p>

<blockquote>
  <ul>
    <li>$ cd php-5.3.8 </li>
    <li>$ vi configure.in (add AC_SYS_LARGEFILE somewhere)</li>
    <li>$ export PHP_AUTOCONF=/usr/share/autoconf2.59</li>
    <li>$ ./buildconf –force</li>
  </ul>
</blockquote>

<p>I then tried two things. First i build without the CFLAGS. But this didn’t seem to do much. Then i used the same configure script with the CFLAGS for large file support. But there was no speed increase measurable. </p>

<p>So why would Ubuntu have made the choice to compile PHP with the large file support on a 32-bit platform? Are there really that much developers that work on large files in web / cli applications written in PHP? Enough to sacrifice a 50% speed decrease?</p>

<p>I don’t really know the answer to that. But i will do my large file processing on 64-bit machines. And will compile PHP from scratch from now on. Until i have upgraded my aging hardware.</p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      <a href="http://blog.lenss.nl/2011/09/php-slow-on-32-bit-ubuntu/#disqus_thread">Comments</a>
      
      








  


<time datetime="2011-09-07T14:09:44+02:00" pubdate data-updated="true">Sep 7<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://blog.lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://blog.lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://blog.lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://blog.lenss.nl/2011/08/php5-filesize-limit-on-32-bit-system/">PHP5 Filesize Limit on 32-bit System</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>So we have a PHP based importer script that does some heavy duty media processing at the office. And i had to import some new media today. But for some reason a couple of files weren’t picked up without a message. So i cleaned up the upload folder. The only files left were the files not being processed. And when i started the importer. The result was.</p>

<blockquote>

  <p>Importer found (0) files to import!</p>
</blockquote>

<p>Hmmm. That’s not right. So i had a look at the code behind the importer. Which basically is a loop using a <a href="http://nl2.php.net/manual/en/class.directoryiterator.php">DirectoryIterator</a> object. And some var_dump calls revealed the issue. For some reason <a href="http://nl2.php.net/manual/en/splfileinfo.isfile.php">-&gt;isFile()</a> was returning <em>(false)</em> for regular files. WTF! Let’s test that on the command line.</p>

<blockquote>
  <p>$ php -r “var_dump(is_file(‘/some/file.ext’));”;
<em>bool(false)</em></p>
</blockquote>

<p>Ok so we have an issue here. How big are these files really. A inspection revealed they are all over 2GB. Maybe some 32 bit issue? As the platform the code is running on is a 32 bit server. So i asked my colleagues, Googled a bit and read through php.net. To find out that there is an issue with PHP and files larger then 2GB.</p>

<blockquote>
  <p><a href="https://bugs.php.net/bug.php?id=27792">https://bugs.php.net/bug.php?id=27792</a>
<a href="https://bugs.php.net/bug.php?id=48886">https://bugs.php.net/bug.php?id=48886</a>
<a href="http://nl.php.net/manual/en/function.filesize.php">http://nl.php.net/manual/en/function.filesize.php</a></p>
</blockquote>

<p>Those however all seem related to filesize. The filesize function manual page even has a note about it. Maybe it’s related?</p>

<blockquote>
  <p><strong>Note:</strong> Because PHP’s integer type is signed and many platforms use 32bit integers, <strong>filesize() ** may return unexpected results for files which are larger than **2GB</strong>. For files between 2GB and 4GB in size this can usually be overcome by using <strong>sprintf(“%u”, filesize($file))</strong>. </p>
</blockquote>

<p>But i can’t apply that patch on a production server. So i came up with a simple solution for now. I extended the <a href="http://nl2.php.net/manual/en/class.directoryiterator.php">DirectoryIterator</a> class and have overwritten the <em>isFile</em> method. Which works for now (don’t think this will work on windows).</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">Class</span> <span class="constant">MyDirectoryIterator</span> <span class="keyword">extends</span> <span class="constant">DirectoryIterator</span> {
  <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">isFile</span>() {
    <span class="keyword">return</span> (<span class="predefined-type">integer</span>) <span class="predefined">exec</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">[ -f </span><span class="inline"><span class="delimiter">{</span><span class="local-variable">$this</span>-&gt;getPathname()<span class="delimiter">}</span></span><span class="content"> ] &amp;&amp; echo 1 || echo 0</span><span class="delimiter">&quot;</span></span>);
  }
}
</pre></div>
</div>
 </figure></notextile></div>

<p>Convinced it was a 32 bit issue. I came home later that day. And wanted to try it out on my own desktop. That is a 32 bit system and runs Ubuntu 11.04. To my surprise the result was different then i expected.</p>

<blockquote>
  <ul>
    <li>$ php -r “var_dump(is_file(‘/some/file.ext’));”;</li>
    <li><em>bool(true)</em></li>
  </ul>
</blockquote>

<p>I used the same files as before. And tested some more big files. But the result was the same. Weird. Let’s try some other 32 bit machines.</p>

<blockquote>
  <p>Ubuntu 11.04: bool(true)</p>
</blockquote>

<p>CentOS release 5.6 (Final): bool(false)
Debian 6.0.2 (squeeze): bool(false)</p>

<p>Only my desktop at home seems to have a good result. Ubuntu must have some patch somewhere to fix this issue? To confirm i compiled PHP 5.3.8 from source. And did the same test again on Ubuntu 11.04. And this time it was <em>(false)</em>.</p>

<blockquote>
  <ul>
    <li>$ php -r “var_dump(is_file(‘/some/file.ext’));”;</li>
    <li><em>bool(false)</em></li>
  </ul>
</blockquote>

<p>I am not really in the mood to search the Ubuntu <a href="http://changelogs.ubuntu.com/changelogs/pool/main/p/php5/">changelog</a>. And for now the work around will do. But i really would like to know what patch is applied to resolve the issue.</p>

<p><strong>[ update ]</strong></p>

<p>While applying the patch for the is_file issue. I was confronted with the fact that way more function calls cause issues. So while waiting for PHP to get patched i had to create some workarounds for the time being.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption class="code-header" style="margin-bottom:-5px;"><span>Getting the filesize </span></figcaption>
 <div class="CodeRay">
  <div class="code"><pre>
(<span class="predefined-type">integer</span>) <span class="predefined">exec</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">stat -c%s </span><span class="inline"><span class="delimiter">{</span><span class="local-variable">$file</span>-&gt;getFilename()<span class="delimiter">}</span></span><span class="delimiter">&quot;</span></span>);
</pre></div>
</div>
 </figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption class="code-header" style="margin-bottom:-5px;"><span>Calculate a MD5 checksum </span></figcaption>
 <div class="CodeRay">
  <div class="code"><pre>
<span class="local-variable">$md5</span> = <span class="predefined">exec</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">md5sum </span><span class="inline"><span class="delimiter">{</span><span class="local-variable">$file</span>-&gt;getFilename()<span class="delimiter">}</span></span><span class="delimiter">&quot;</span></span>);
<span class="local-variable">$expl</span> = <span class="predefined">explode</span>(<span class="string"><span class="delimiter">'</span><span class="content">\t</span><span class="delimiter">'</span></span>, <span class="local-variable">$md5</span>);
<span class="keyword">return</span> (<span class="predefined-type">string</span>) <span class="local-variable">$expl</span>[<span class="integer">0</span>];
</pre></div>
</div>
 </figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption class="code-header" style="margin-bottom:-5px;"><span>Calculate the CRC32 checksum </span></figcaption>
 <div class="CodeRay">
  <div class="code"><pre>
<span class="local-variable">$hash</span> = <span class="predefined">exec</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">cksum </span><span class="inline"><span class="delimiter">{</span><span class="local-variable">$this</span>-&gt;path<span class="delimiter">}</span></span><span class="delimiter">&quot;</span></span>);
<span class="local-variable">$expl</span> = <span class="predefined">explode</span>(<span class="string"><span class="delimiter">'</span><span class="content"> </span><span class="delimiter">'</span></span>, <span class="local-variable">$hash</span>);
<span class="keyword">return</span> <span class="local-variable">$expl</span>[<span class="integer">0</span>];
</pre></div>
</div>
 </figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption class="code-header" style="margin-bottom:-5px;"><span>Get the modified time </span></figcaption>
 <div class="CodeRay">
  <div class="code"><pre>
<span class="local-variable">$stat</span> = <span class="predefined">explode</span>(<span class="string"><span class="delimiter">'</span><span class="content">.</span><span class="delimiter">'</span></span>, <span class="predefined">exec</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">stat -c%y </span><span class="inline"><span class="delimiter">{</span><span class="local-variable">$this</span>-&gt;path<span class="delimiter">}</span></span><span class="delimiter">&quot;</span></span>));
<span class="local-variable">$timestamp</span> = <span class="predefined">strtotime</span>(<span class="local-variable">$stat</span>[<span class="integer">0</span>]);
<span class="keyword">return</span> <span class="local-variable">$timestamp</span>;
</pre></div>
</div>
 </figure></notextile></div>

<p>Hopefully that will do for now. On a side note the issue is solvable by setting certain <strong>CFLAGS</strong> when compiling PHP. I have no idea what the impact of that will be on the PHP binary. But it does seem to solve the issue. Not sure how one would apply that when PHP is installed from the distro’s repository though.</p>

<blockquote>
  <p>CFLAGS=”-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64” ./configure</p>
</blockquote>

</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      <a href="http://blog.lenss.nl/2011/08/php5-filesize-limit-on-32-bit-system/#disqus_thread">Comments</a>
      
      








  


<time datetime="2011-08-31T01:38:00+02:00" pubdate data-updated="true">Aug 31<span>st</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://blog.lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://blog.lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://blog.lenss.nl/tag/tech/'>Tech</a>, <a class='category' href='http://blog.lenss.nl/tag/zend/'>Zend</a>
  
</span>


    </p>
  </footer>
  </article>
  

  <ul class="pager">
    
    <li><a href="http://blog.lenss.nl/page/5/">&larr; Older</a></li>
    
    
    <li><a href="http://blog.lenss.nl/page/3/">Newer &rarr;</a></li>
    
  </ul>

  <div class="blog-copy">
      Copyright &copy; 2015 - Thijs Lensselink -
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  </div>
</div>

	      </div>
	  </div>

        </div>

        <div class="col-sm-4 col-sm-offset-0 blog-sidebar">
	    <div id="sidebar">
	       
	           
<div class="sidebox">
	<div class="me">
		<a href="http://www.zend.com/store/education/certification/yellow-pages.php#show-ClientCandidateID=ZEND006598"><img src="http://blog.lenss.nl/images/php5-zce-logo-new.gif" height="50" /></a>
		<a href="http://stackoverflow.com/users/476697/tlenss">
			<img src="http://stackoverflow.com/users/flair/476697.png?theme=dark" width="179" height="50" alt="profile for tlenss at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for tlenss at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
		</a>
		<div class="gpg">
			Key ID : <a href="http://blog.lenss.nl/C773940D.asc">0xC773940D</a><br/>
			Fingerprint : 9AF2 38D6 3172 2F3E 112F 9024 C558 F5CD C773 940D
		</div>
	</div>
</div>

<section>
  <div class="sidebox">
	<h1>Recent entries</h1>
	<ul class="linklist">
		
		<li><a href="http://blog.lenss.nl/2015/07/PHP-project-top10-list/">PHP Project Top10 List</a></li>
		
		<li><a href="http://blog.lenss.nl/2015/05/git-shell-tools/">Git shell tools</a></li>
		
		<li><a href="http://blog.lenss.nl/2015/02/composer-install-on-git-clone/">Run Composer on Git clone</a></li>
		
		<li><a href="http://blog.lenss.nl/2015/02/octopress-blog-hijacked-by-javascript/">Octopress blog hijacked</a></li>
		
		<li><a href="http://blog.lenss.nl/2015/01/using-the-hub-in-github-pull-requests/">Using the hub in Github - pull requests</a></li>
		
		<li><a href="http://blog.lenss.nl/2015/01/git-view-unpushed-changes/">View unpushed changes in git</a></li>
		
		<li><a href="http://blog.lenss.nl/2014/09/secure-cloud-storage-with-google-and-encfs-on-ubuntu/">Secure cloud storage with Google and encfs on Ubuntu</a></li>
		
		<li><a href="http://blog.lenss.nl/2013/11/first-weekday-of-month-in-php/">Get the first weekday of the month in PHP</a></li>
		
		<li><a href="http://blog.lenss.nl/2013/10/git-move-folder-containing-submodules/">Renaming a folder in git that contains submodules</a></li>
		
		<li><a href="http://blog.lenss.nl/2013/10/clover-forcast-for-php-in-jenkins/">Fixing the clover forcast for PHP projects in Jenkins</a></li>
		
	</ul>
</div>
</section>

<div class="sidebox ad">
	<script type="text/javascript"><!--
	google_ad_client = "ca-pub-0921745317573569";
	/* nlblue_side */
	google_ad_slot = "7706621160";
	google_ad_width = 300;
	google_ad_height = 250;
	//-->
	</script>
	<script type="text/javascript"
	src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
	</script>
</div>
<div class="sidebox">
	<h1>Tags</h1>
	<ul id="tag-cloud" class="blocklist"><a href='http://blog.lenss.nl/tag/-home' style='font-size: 119.39393939393939%'>/home(32)</a> <a href='http://blog.lenss.nl/tag/cloud' style='font-size: 100.60606060606061%'>Cloud(1)</a> <a href='http://blog.lenss.nl/tag/code' style='font-size: 160.0%'>Code(99)</a> <a href='http://blog.lenss.nl/tag/design' style='font-size: 102.42424242424242%'>Design(4)</a> <a href='http://blog.lenss.nl/tag/development' style='font-size: 101.21212121212122%'>Development(2)</a> <a href='http://blog.lenss.nl/tag/freelance' style='font-size: 102.42424242424242%'>Freelance(4)</a> <a href='http://blog.lenss.nl/tag/git' style='font-size: 103.63636363636364%'>Git(6)</a> <a href='http://blog.lenss.nl/tag/google' style='font-size: 101.81818181818181%'>Google(3)</a> <a href='http://blog.lenss.nl/tag/javascript' style='font-size: 104.84848484848484%'>Javascript(8)</a> <a href='http://blog.lenss.nl/tag/jenkins' style='font-size: 100.60606060606061%'>Jenkins(1)</a> <a href='http://blog.lenss.nl/tag/jquery' style='font-size: 101.21212121212122%'>Jquery(2)</a> <a href='http://blog.lenss.nl/tag/magento' style='font-size: 101.21212121212122%'>Magento(2)</a> <a href='http://blog.lenss.nl/tag/php' style='font-size: 142.42424242424244%'>PHP(70)</a> <a href='http://blog.lenss.nl/tag/security' style='font-size: 105.45454545454545%'>Security(9)</a> <a href='http://blog.lenss.nl/tag/sql' style='font-size: 103.63636363636364%'>SQL(6)</a> <a href='http://blog.lenss.nl/tag/tech' style='font-size: 160.0%'>Tech(99)</a> <a href='http://blog.lenss.nl/tag/zend' style='font-size: 104.84848484848484%'>Zend(8)</a> </ul>
	<div style="clear:both;"></div>
</div>
<section>
  <div class="sidebox">
	<h1>GitHub Repos</h1>
	
	<ul class="linklist" id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/tlenss" class="github-follow-button">Follow On GitHub</a>
  
</div>
</section>


<section>
  <div class="sidebox">
	<!-- <h1>Latest Tweets</h1> -->
<a class="twitter-timeline" href="https://twitter.com/tlenss" data-widget-id="408894330036703232">Tweets by @tlenss</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</div>
</section>


	       
	    </div>
        </div>

      </div>

    </div>

    <script src="http://blog.lenss.nl/javascripts/jquery-2.1.0.min.js"></script>
    <script src="http://blog.lenss.nl/javascripts/bootstrap-3.1.1.min.js"></script>
    <script src="http://blog.lenss.nl/javascripts/modernizr-2.0.js"></script>
    <script src="http://blog.lenss.nl/javascripts/ender.js"></script>
    <script src="http://blog.lenss.nl/javascripts/octopress.js"></script>
    <script src="http://blog.lenss.nl/javascripts/github.js"></script>
    <script src="http://blog.lenss.nl/javascripts/twitter.js"></script>
    <script src="http://blog.lenss.nl/javascripts/jquery.cookie.min.js"></script>
    <script src="http://blog.lenss.nl/javascripts/adn-timeline.js"></script>
    <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = 'http://blog.lenss.nl/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'tlenss',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
    
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8003524-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  </body>
</html>
