
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Thijs Lensselink's Blog</title>
  <meta name="author" content="Thijs Lensselink">

  
  <meta name="description" content="Zend Framework Bootstrapping Modules I am working on a small API for my own backend and i wanted a modular architecture. I have done this before &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lenss.nl/page/8/">
  <link href="http://lenss.nl/favicon.png" rel="icon">
  <link href="http://lenss.nl/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="http://lenss.nl/javascripts/libs/jquery-1.8.1.js"></script>
  <script src="http://lenss.nl/javascripts/modernizr-2.0.js"></script>
  <script src="http://lenss.nl/javascripts/ender.js"></script>
  <script src="http://lenss.nl/javascripts/octopress.js"></script>
  <script src="http://lenss.nl/javascripts/github.js"></script>
  <script src="http://lenss.nl/javascripts/twitter.js"></script>
  <script type="text/javascript" src="http://lenss.nl/javascripts/jquery.cookie.min.js"></script>
  <script type="text/javascript" src="http://lenss.nl/javascripts/adn-timeline.js"></script>
  <link href="http://feeds.feedburner.com/ThijsLensselinksBlog" rel="alternate" title="Thijs Lensselink's Blog" type="application/atom+xml">
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8003524-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <script type="text/javascript">
	$(document).ready(function() {
		$('#logo').click(function() {
			window.location = '/';
		});
	});
  </script>
</head>

<body   >
<div id="content">
	<div class="inner">
        <div class="blog-index">
  
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2010/02/zend-framework-bootstrapping-modules/">Zend Framework Bootstrapping Modules</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>I am working on a small API for my own backend and i wanted a modular architecture. I have done this before using the Zend Framework. But this time i wanted a bit more control while loading the modules. And adding a <a href="http://framework.zend.com/manual/1.10/en/zend.application.quick-start.html">Bootstrap</a> class would seem like a good option. The only example i could find involved loading all bootstraps on every request. Which doesn’t seem like a good idea. So after reading through the Manual and some blog posts. I decided to give it s shot my self.</p>

<p>The structure i want looks like this.</p>

<p><a href="http://lenss.nl/images/2010/02/module-based.jpg"><img src="http://lenss.nl/images/2010/02/module-based.jpg" alt="" /></a></p>

<p>The application.ini file has the following contents:</p>

<blockquote>
  <ul>
    <li>includePaths.library = APPLICATION_PATH “/../library”</li>
    <li>bootstrap.path = APPLICATION_PATH “/Bootstrap.php”</li>
    <li>bootstrap.class = “Bootstrap”</li>
    <li>resources.frontController.moduleDirectory = APPLICATION_PATH “/modules”</li>
    <li>resources.modules[] = “default”</li>
    <li>resources.modules[] = “admin”</li>
  </ul>
</blockquote>

<p><strong>includePaths</strong>
This sets the applications local library location. Any shared code for this application goes here.</p>

<p><strong>bootstrap.path &amp; class</strong>
Define the location and type of the Bootstrap class.</p>

<p><strong>resources</strong>
Define the modules location and create a list of modules.</p>

<p>The main Bootstrap class</p>

<p><strong>application/Bootstrap.php</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">class</span> <span class="class">Bootstrap</span> <span class="keyword">extends</span> <span class="constant">Zend_Application_Bootstrap_Bootstrap</span>
{
</pre></div>
</div>
 </figure></notextile></div>

<p>Load the config parameters for this application and set some debugging settings if needed.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">protected</span> <span class="keyword">function</span> <span class="function">_initConfiguration</span>()
{
  <span class="local-variable">$app</span> = <span class="local-variable">$this</span>-&gt;getApplication();
  <span class="local-variable">$config</span> = <span class="local-variable">$app</span>-&gt;getOptions();

  <span class="keyword">if</span> (<span class="constant">APPLICATION_ENV</span> == <span class="string"><span class="delimiter">'</span><span class="content">development</span><span class="delimiter">'</span></span>) {
    <span class="predefined">error_reporting</span>(<span class="exception">E_ALL</span> &amp; <span class="exception">E_STRICT</span>);
    <span class="keyword">if</span> (<span class="predefined">isset</span>(<span class="local-variable">$config</span>[<span class="string"><span class="delimiter">'</span><span class="content">phpsettings</span><span class="delimiter">'</span></span>])) {
      <span class="keyword">foreach</span> (<span class="local-variable">$config</span>[<span class="string"><span class="delimiter">'</span><span class="content">phpsettings</span><span class="delimiter">'</span></span>] <span class="keyword">as</span> <span class="local-variable">$setting</span> =&gt; <span class="local-variable">$value</span>) {
        ini_set(<span class="local-variable">$setting</span>, <span class="local-variable">$value</span>);
      }  
    }
  }
}
</pre></div>
</div>
 </figure></notextile></div>

<p>We need autoloading here because we are using a class from the application library. Right now this causes a problem. A notice is thrown </p>

<blockquote>
  <p>Warning: include_once(FrontController.php) [function.include-once]: failed to open stream: No such file or directory in Zend/Loader.php  on line 147</p>
</blockquote>

<p>The application responds fine. And this problem seems to be a recurring issue (<a href="http://framework.zend.com/issues/browse/ZF-7224">ZF-7224</a>, <a href="http://framework.zend.com/issues/browse/ZF-7550">ZF-7550</a>) for the framework. Until now i have not find a graceful fix for this. besides a small <a href="http://framework.zend.com/issues/secure/attachment/12131/BootstrapAbstract.patch">patch</a> reversion.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">protected</span> <span class="keyword">function</span> <span class="function">_initAutoload</span>()
{
  <span class="local-variable">$autoloader</span> = <span class="constant">Zend_Loader_Autoloader</span>::getInstance();
  <span class="local-variable">$autoloader</span>-&gt;setFallbackAutoloader(<span class="predefined-constant">true</span>);

  <span class="keyword">return</span> <span class="local-variable">$autoloader</span>;
}
</pre></div>
</div>
 </figure></notextile></div>

<p>Setup the controller to register the <strong>Bluess_Modules_Loader</strong> plug-in. And set the <strong>prefixDefaultModule</strong> parameter so we can prefix the default module controllers as well. Just for the sake of consistency. The <strong>Bluess_</strong> namespace is part of my API. And can be changed at will.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">protected</span> <span class="keyword">function</span> <span class="function">_initController</span>()
{
  <span class="local-variable">$this</span>-&gt;bootstrap(<span class="string"><span class="delimiter">'</span><span class="content">FrontController</span><span class="delimiter">'</span></span>); 
  <span class="local-variable">$controller</span> = <span class="local-variable">$this</span>-&gt;getResource(<span class="string"><span class="delimiter">'</span><span class="content">FrontController</span><span class="delimiter">'</span></span>);
  <span class="local-variable">$modules</span> = <span class="local-variable">$controller</span>-&gt;getControllerDirectory();
  <span class="local-variable">$controller</span>-&gt;setParam(<span class="string"><span class="delimiter">'</span><span class="content">prefixDefaultModule</span><span class="delimiter">'</span></span>, <span class="predefined-constant">true</span>);
        
  <span class="local-variable">$controller</span>-&gt;registerPlugin(
    <span class="keyword">new</span> <span class="constant">Bluess_Modules_Loader</span>(<span class="local-variable">$modules</span>)
  );
        
  <span class="keyword">return</span> <span class="local-variable">$controller</span>;
}
</pre></div>
</div>
 </figure></notextile></div>

<p>Now the last method. which is a bit weird. And i am probably missing a key factor here. But if this method <strong>resource</strong> is not declared only the default module functions. When declared empty all modules function as they should. This would indicate that this method could be used to load the modules. But i haven’t found a way to achieve this yet. Except for loading all modules in a row. Which makes no sense for this purpose. So we leave it empty.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">protected</span> <span class="keyword">function</span> <span class="function">_initModules</span>()
{
  <span class="comment">// Call to prevent ZF from loading all modules</span>
}
</pre></div>
</div>
 </figure></notextile></div>

<p>The most important part here is the controller plug-in. This will be the place where module bootstraps are called from.</p>

<p><strong>application/../library/Bluess/Modules/Loader.php</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">class</span> <span class="class">Bluess_Modules_Loader</span> <span class="keyword">extends</span> <span class="constant">Zend_Controller_Plugin_Abstract</span>
{
  <span class="keyword">protected</span> <span class="local-variable">$_modules</span>;
</pre></div>
</div>
 </figure></notextile></div>

<p>Setup the plug-in by passing the applications module list.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">public</span> <span class="keyword">function</span> <span class="function">__construct</span>(<span class="predefined">array</span> <span class="local-variable">$modulesList</span>) 
{
  <span class="local-variable">$this</span>-&gt;_modules = <span class="local-variable">$modulesList</span>;
}
</pre></div>
</div>
 </figure></notextile></div>

<p>The <strong>dispatchLoopStartup</strong> method will be called on every request and will do the magic. Based on the current module name we create a new <strong>Zend_Application</strong> with the current modules config file <strong>module.ini</strong>. And we bootstrap it.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">public</span> <span class="keyword">function</span> <span class="function">dispatchLoopStartup</span>(<span class="constant">Zend_Controller_Request_Abstract</span> <span class="local-variable">$request</span>)
{
  <span class="local-variable">$module</span> = <span class="local-variable">$request</span>-&gt;getModuleName();
        
  <span class="keyword">if</span> (!<span class="predefined">isset</span>(<span class="local-variable">$this</span>-&gt;_modules[<span class="local-variable">$module</span>])) {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="predefined-constant">Exception</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Module does not exist!</span><span class="delimiter">&quot;</span></span>);
  }

  <span class="local-variable">$bootstrapPath</span> = <span class="local-variable">$this</span>-&gt;_modules[<span class="local-variable">$module</span>];
        
  <span class="local-variable">$bootstrapFile</span> = <span class="predefined">dirname</span>(<span class="local-variable">$bootstrapPath</span>) . <span class="string"><span class="delimiter">'</span><span class="content">/Bootstrap.php</span><span class="delimiter">'</span></span>;
  <span class="local-variable">$class</span>         = <span class="predefined">ucfirst</span>(<span class="local-variable">$module</span>) . <span class="string"><span class="delimiter">'</span><span class="content">_Bootstrap</span><span class="delimiter">'</span></span>;
  <span class="local-variable">$application</span>   = <span class="keyword">new</span> <span class="constant">Zend_Application</span>(
    <span class="constant">APPLICATION_ENV</span>,
    <span class="constant">APPLICATION_PATH</span> . <span class="string"><span class="delimiter">'</span><span class="content">/modules/</span><span class="delimiter">'</span></span> . <span class="local-variable">$module</span> . <span class="string"><span class="delimiter">'</span><span class="content">/configs/module.ini</span><span class="delimiter">'</span></span>
  );  

  <span class="keyword">if</span> (<span class="constant">Zend_Loader</span>::loadFile(<span class="string"><span class="delimiter">'</span><span class="content">Bootstrap.php</span><span class="delimiter">'</span></span>, <span class="predefined">dirname</span>(<span class="local-variable">$bootstrapPath</span>)) 
      &amp;&amp; <span class="predefined">class_exists</span>(<span class="local-variable">$class</span>)) {
    <span class="local-variable">$bootstrap</span> = <span class="keyword">new</span> <span class="local-variable">$class</span>(<span class="local-variable">$application</span>);
    <span class="local-variable">$bootstrap</span>-&gt;bootstrap();
  }
}
</pre></div>
</div>
 </figure></notextile></div>

<p>Now setup the default module. Once this is done it’s a nice example for further modules. Make sure the module has it’s own layout set. </p>

<p><strong>application/modules/default/configs/module.ini</strong></p>

<blockquote>
  <p>default.resources.layout.layout = “default”
default.resources.layout.layoutPath = APPLICATION_PATH “/modules/default/layout”</p>
</blockquote>

<p>Setup the modules bootstrap and use it to set the modules model location.</p>

<p><strong>application/modules/default/Bootstrap.php</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">class</span> <span class="class">Default_Bootstrap</span> <span class="keyword">extends</span> <span class="constant">Zend_Application_Module_Bootstrap</span> 
{
  <span class="keyword">protected</span> <span class="local-variable">$_moduleName</span> = <span class="string"><span class="delimiter">'</span><span class="content">default</span><span class="delimiter">'</span></span>;

  <span class="keyword">protected</span> <span class="keyword">function</span> <span class="function">_initConfiguration</span>()
  {
    <span class="local-variable">$options</span> = <span class="local-variable">$this</span>-&gt;getApplication()-&gt;getOptions();
        
    <span class="predefined">set_include_path</span>(<span class="predefined">implode</span>(<span class="predefined-constant">PATH_SEPARATOR</span>, <span class="predefined">array</span>(
      <span class="predefined">realpath</span>(<span class="constant">APPLICATION_PATH</span> . <span class="string"><span class="delimiter">'</span><span class="content">/modules/</span><span class="delimiter">'</span></span> . <span class="local-variable">$this</span>-&gt;_moduleName . <span class="string"><span class="delimiter">'</span><span class="content">/models</span><span class="delimiter">'</span></span>),
      <span class="predefined">get_include_path</span>(),
    )));
        
    <span class="keyword">return</span> <span class="local-variable">$options</span>;
  }
}
</pre></div>
</div>
 </figure></notextile></div>

<p>That’s all. Now make sure your layout is set correctly and the controllers are prefixed</p>

<p><strong>application/modules/default/layout/default.phtml</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="predefined">echo</span> <span class="local-variable">$this</span>-&gt;layout()-&gt;content;
</pre></div>
</div>
 </figure></notextile></div>

<p><strong>application/modules/default/controllers/IndexController.php</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">class</span> <span class="class">Default_IndexController</span> <span class="keyword">extends</span> <span class="constant">Zend_Controller_Action</span>
{
</pre></div>
</div>
 </figure></notextile></div>

<p>It took me a while to get this working like i had it in my mind. But it’s going the right way. If your interested in a working copy. You can download one <a href="http://lenss.nl/code/ZFBootstrappedModules.tar.gz">here</a>.</p>

<p><strong>UPDATE</strong></p>

<p>Matthew has a nice <a href="http://weierophinney.net/matthew/archives/234-Module-Bootstraps-in-Zend-Framework-Dos-and-Donts.html#extended">post </a>about some do’s and don’ts concerning module based applications</p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2010-02-06T22:04:38+01:00" pubdate data-updated="true">Feb 6<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2010/02/zend-framework-bootstrapping-modules/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2010/02/finally-no-more-ie6/">Finally No More IE6</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>Something all Web developers wish for is the fact that Internet Explorer 6.0 disappears from the face of this planet. And after some good initiatives like <a href="http://www.ie6nomore.com/">IE6 no more</a> It now seems the <a href="http://www.google.com">biggest</a> in the field is phasing out support for older browsers. Sometimes its good to have so much influence i guess? :)</p>

<p>Good move!</p>

<p><a href="http://googleenterprise.blogspot.com/2010/01/modern-browsers-for-modern-applications.html">http://googleenterprise.blogspot.com/2010/01/modern-browsers-for-modern-applications.html</a></p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2010-02-01T21:36:44+01:00" pubdate data-updated="true">Feb 1<span>st</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2010/02/finally-no-more-ie6/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2010/01/fixing-wp-e-commerce-for-ideal-payments/">Fixing Wp-e-commerce for iDEAL Payments</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>Last Friday a friend approached me with a problem he was having. He was trying to setup a small webshop in a existing Wordpress site. For the webshop he was using a plug-in called <a href="http://www.instinct.co.nz/e-commerce/">wp-e-commerce</a>. He chose this plug-in because it is one of few that supports <a href="http://www.ideal.nl/">iDEAL</a> payments. Because this shop only serves Holland the only payment option they need is iDEAL.</p>

<p>The iDEAL plug-in seemed to function properly. But the bank portal didn’t respond as expected. The first error i spotted was the mis configured referrer. The error code for this was.</p>

<blockquote>
  <p>unknown order/0/r</p>
</blockquote>

<p>This didn’t solve the problem though. The message change from the previous to</p>

<blockquote>
  <p>unknown order/1/s</p>
</blockquote>

<p>So i spend the next hours reading the manual he got from his bank. And came to the conclusion they do it just a bit different then for what this plug-in was written. The bank expects a hash to be send along each order made. This hash is build up from parts of the order and a secret string. This combined is hashed with the <a href="http://www.faqs.org/rfcs/rfc3174.html">SHA-1</a> algorithm And added to the form as a hidden field. I wrote a small function to create hash and changed a few other small things in the order form.</p>

<p>The original form looks like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">var</span> Amount = &lt;?php echo <span class="predefined">$amount</span>; ?&gt;;
<span class="keyword">var</span> PSPID = <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;?php echo get_option('ideal_id');?&gt;</span><span class="delimiter">&quot;</span></span>;
<span class="keyword">var</span> AM;
<span class="keyword">if</span> (isNaN(Amount)) {
  alert(<span class="string"><span class="delimiter">&quot;</span><span class="content">Amount not a number: </span><span class="delimiter">&quot;</span></span> + Amount + <span class="string"><span class="delimiter">&quot;</span><span class="content"> !</span><span class="delimiter">&quot;</span></span>);
  AM = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
} <span class="keyword">else</span> {
  AM = Math.round(parseFloat(Amount)*<span class="integer">100</span>);
}
</pre></div>
</div>
 </figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="tag">&lt;form</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">'</span><span class="content">post</span><span class="delimiter">'</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">'</span></span><span class="inline-delimiter">&lt;?php</span> <span class="predefined">echo</span> <span class="local-variable">$submiturl</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">'</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">'</span><span class="content">ideal_form</span><span class="delimiter">'</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">ideal_form</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/javascript</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">document.write(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;input type=</span><span class="char">\&quot;</span><span class="content">hidden</span><span class="char">\&quot;</span><span class="content"> NAME=</span><span class="char">\&quot;</span><span class="content">PSPID</span><span class="char">\&quot;</span><span class="content"> value=</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> + PSPID + <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content"> /&gt;</span><span class="delimiter">&quot;</span></span>);
document.write(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;input type=</span><span class="char">\&quot;</span><span class="content">hidden</span><span class="char">\&quot;</span><span class="content"> NAME=</span><span class="char">\&quot;</span><span class="content">amount</span><span class="char">\&quot;</span><span class="content"> value=</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> + AM + <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content"> /&gt;</span><span class="delimiter">&quot;</span></span>);</span>
<span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;INPUT</span> <span class="attribute-name">TYPE</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">NAME</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SHASign</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">VALUE</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4FF8C2FB03B0AA45EA5DE9503AEACB6B603DCFCC</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">NAME</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">orderID</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?php</span> <span class="predefined">echo</span> <span class="local-variable">$purchase_log</span>[<span class="integer">0</span>][<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>];<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">currency</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?php</span> <span class="predefined">echo</span> get_option(<span class="string"><span class="delimiter">'</span><span class="content">ideal_currency</span><span class="delimiter">'</span></span>);<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">language</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?php</span> <span class="predefined">echo</span> get_option(<span class="string"><span class="delimiter">'</span><span class="content">ideal_language</span><span class="delimiter">'</span></span>);<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accepturl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?php</span> <span class="predefined">echo</span> get_option(<span class="string"><span class="delimiter">'</span><span class="content">product_list_url</span><span class="delimiter">'</span></span>);<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cancelurl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?php</span> <span class="predefined">echo</span> get_option(<span class="string"><span class="delimiter">'</span><span class="content">shopping_cart_url</span><span class="delimiter">'</span></span>);<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="comment">&lt;!--customer information starts--&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CN</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?</span>=<span class="local-variable">$name</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMAIL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?</span>=<span class="local-variable">$email</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ownerZIP</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?</span>=<span class="local-variable">$postcode</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">owneraddress</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?</span>=<span class="local-variable">$address</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ownercty</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?</span>=<span class="local-variable">$country</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ownertown</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?</span>=<span class="local-variable">$city</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ownertelno</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?</span>=<span class="local-variable">$phone</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="comment">&lt;!--customer information ends--&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PM</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">iDEAL</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
</pre></div>
</div>
 </figure></notextile></div>

<p>I didn’t really understand why some values were written by JavaScript. So i removed the JavaScript lines and added the fields to the form. And after adding the hash function statement it looks like this.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="tag">&lt;form</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">'</span><span class="content">post</span><span class="delimiter">'</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">'</span></span><span class="inline-delimiter">&lt;?php</span> <span class="predefined">echo</span> <span class="local-variable">$submiturl</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">'</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">'</span><span class="content">ideal_form</span><span class="delimiter">'</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">ideal_form</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">NAME</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PSPID</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?php</span> <span class="predefined">echo</span> get_option(<span class="string"><span class="delimiter">'</span><span class="content">ideal_id</span><span class="delimiter">'</span></span>);<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">NAME</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">orderID</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?php</span> <span class="predefined">echo</span> <span class="local-variable">$purchase_log</span>[<span class="integer">0</span>][<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>];<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">NAME</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">amount</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?php</span> <span class="predefined">echo</span> (<span class="local-variable">$amount</span>*<span class="integer">100</span>); <span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">currency</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?php</span> <span class="predefined">echo</span> get_option(<span class="string"><span class="delimiter">'</span><span class="content">ideal_currency</span><span class="delimiter">'</span></span>);<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">language</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?php</span> <span class="predefined">echo</span> get_option(<span class="string"><span class="delimiter">'</span><span class="content">ideal_language</span><span class="delimiter">'</span></span>);<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accepturl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?php</span> <span class="predefined">echo</span> get_option(<span class="string"><span class="delimiter">'</span><span class="content">product_list_url</span><span class="delimiter">'</span></span>);<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cancelurl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?php</span> <span class="predefined">echo</span> get_option(<span class="string"><span class="delimiter">'</span><span class="content">shopping_cart_url</span><span class="delimiter">'</span></span>);<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="comment">&lt;!--customer information starts--&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CN</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?</span>=<span class="local-variable">$name</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMAIL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?</span>=<span class="local-variable">$email</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ownerZIP</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?</span>=<span class="local-variable">$postcode</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">owneraddress</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?</span>=<span class="local-variable">$address</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ownercty</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?</span>=<span class="local-variable">$country</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ownertown</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?</span>=<span class="local-variable">$city</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ownertelno</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span></span><span class="inline-delimiter">&lt;?</span>=<span class="local-variable">$phone</span>;<span class="inline-delimiter">?&gt;</span><span class="string"><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="comment">&lt;!--customer information ends--&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PM</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">iDEAL</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
</pre></div>
</div>
 </figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="predefined">echo</span> createSHA1Hash(<span class="predefined">array</span>(
  <span class="local-variable">$purchase_log</span>[<span class="integer">0</span>][<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>],
  (<span class="local-variable">$amount</span>*<span class="integer">100</span>),
  get_option(<span class="string"><span class="delimiter">'</span><span class="content">ideal_currency</span><span class="delimiter">'</span></span>),
  get_option(<span class="string"><span class="delimiter">'</span><span class="content">ideal_id</span><span class="delimiter">'</span></span>),
  <span class="string"><span class="delimiter">'</span><span class="content">[SHA1-IN-HASH]</span><span class="delimiter">'</span></span>
));
</pre></div>
</div>
 </figure></notextile></div>

<p>The function i can be placed anywhere in the page. Or a include file. Here’s the code. The only thing that has to be done is replace <strong>[SHA1-IN-HASH]</strong> with the Hash configured in the bank’s ideal admin.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre> 
<span class="keyword">function</span> <span class="function">createSHA1Hash</span>(<span class="local-variable">$hashOptions</span>) {
  <span class="local-variable">$str</span> = <span class="predefined">implode</span>(<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>, <span class="local-variable">$hashOptions</span>);

  <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">&lt;input name=&quot;SHASign&quot; type=&quot;hidden&quot; value=&quot;</span><span class="delimiter">'</span></span> . <span class="predefined">sha1</span>(<span class="local-variable">$str</span>) . <span class="string"><span class="delimiter">'</span><span class="content">&quot; /&gt;</span><span class="delimiter">'</span></span>;
}
</pre></div>
</div>
 </figure></notextile></div>

<p>While doing some searches i noticed there are more people having issues with this plug-in. So maybe this will save somebody a bit of time.</p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2010-01-30T17:03:02+01:00" pubdate data-updated="true">Jan 30<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2010/01/fixing-wp-e-commerce-for-ideal-payments/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2010/01/cache-data-with-zend-framework-and-memcached/">Cache Data With Zend Framework and Memcached</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>Last week i had the chance to work with memcache. Something i hadn’t done before. For caching i mostly rely on APC for bytecode. And file based caching for content. Using memecache extension for PHP and de memcached service gives a whole range of features for caching data. And an easy way to manage all this cached data.</p>

<p>The project i am working on is based on Zend Framework. And there for this post will reflect working with memcache in ZF only. With ZF and memcache it’s possible to do frontend and backend caching. I will focuse on the backend side for now. But will setup the frontend as well.</p>

<p>If you don’t have memcache installed do it now. It’s not that hard. On my debian box it went somethign like this:</p>

<blockquote>
  <ul>
    <li>$ aptitude install memcached</li>
    <li>$ aptitude install php5-memcache</li>
  </ul>
</blockquote>

<p>Now a days evrything seems to go automatic. So no need to edit the php.ini or anyhting. To check if PHP loaded the memcache extension you can do:</p>

<blockquote>
  <ul>
    <li>
      <table>
        <tbody>
          <tr>
            <td>$ php -m</td>
            <td>grep memcache</td>
          </tr>
        </tbody>
      </table>
    </li>
    <li>memcache</li>
  </ul>
</blockquote>

<p>Memached is automatically started after install. So let’s check if everything went ok.</p>

<blockquote>
  <p>$ ps -aux | grep memcached
* nobody   20965  0.0  0.5  42900 23072 ?        S    Jan28   0:01 /usr/bin/memcached -m 64 -p 11211 -u nobody -l 127.0.0.1
* root     22393  0.0  0.0  87940   776 pts/0    R+   12:06   0:00 grep memcached</p>
</blockquote>

<blockquote>

  <ul>
    <li>
      <table>
        <tbody>
          <tr>
            <td>$ netstat -an</td>
            <td>grep 11211</td>
          </tr>
        </tbody>
      </table>
    </li>
    <li>tcp        0      0 127.0.0.1:11211         0.0.0.0:*               LISTEN</li>
  </ul>
</blockquote>

<p>Looking good. Now it’s time to do some configuration in ZF.</p>

<p>First of the frontend settings. With ‘type’ we set the cache method for the frontend. We chose the standard Core class for this. With ‘lifetime’ we set the time for which a cached entity is valid. The ‘cache_id_prefix’ is a nice way to group for instnace cache data by controller. So just give it a name.</p>

<blockquote>
  <ul>
    <li>cache.frontend.type = Core</li>
    <li>cache.frontend.options.lifetime = 600</li>
    <li>cache.frontend.options.automatic_serialization = true</li>
    <li>cache.frontend.options.cache_id_prefix = [some string]</li>
    <li>cache.frontend.options.cache = true</li>
  </ul>
</blockquote>

<p>Now it’s the backends turn to get configured. For ‘type’ we choose Memcached. More types are available. For more info read the ZF manual. The rest of the settings are basic memcached settings like host, port and persitance.</p>

<blockquote>
  <ul>
    <li>cache.backend.type = Memcached</li>
    <li>cache.backend.options.servers.1.host = 127.0.0.1</li>
    <li>cache.backend.options.servers.1.port = 11211</li>
    <li>cache.backend.options.servers.1.persistent = true</li>
    <li>cache.backend.options.servers.1.weight = 1</li>
    <li>cache.backend.options.servers.1.timeout = 5</li>
    <li>cache.backend.options.servers.1.retry_interval = 15</li>
  </ul>
</blockquote>

<p>Finally we can do some PHP code. To get the cache instance setup we add a _initCache() method to the bootstrap class. Inside this method we retrieve the config options by calling getOptions(). And setup the cache object. Which is then stored in the Registry for later use.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">protected</span> <span class="keyword">function</span> <span class="function">_initCache</span>()
{
  <span class="local-variable">$options</span> = <span class="local-variable">$this</span>-&gt;getOptions();

  <span class="keyword">if</span> (<span class="predefined">isset</span>(<span class="local-variable">$options</span>[<span class="string"><span class="delimiter">'</span><span class="content">cache</span><span class="delimiter">'</span></span>])) {
    <span class="local-variable">$cache</span> = <span class="constant">Zend_Cache</span>::factory(
      <span class="local-variable">$options</span>[<span class="string"><span class="delimiter">'</span><span class="content">cache</span><span class="delimiter">'</span></span>][<span class="string"><span class="delimiter">'</span><span class="content">frontend</span><span class="delimiter">'</span></span>][<span class="string"><span class="delimiter">'</span><span class="content">type</span><span class="delimiter">'</span></span>],
      <span class="local-variable">$options</span>[<span class="string"><span class="delimiter">'</span><span class="content">cache</span><span class="delimiter">'</span></span>][<span class="string"><span class="delimiter">'</span><span class="content">backend</span><span class="delimiter">'</span></span>][<span class="string"><span class="delimiter">'</span><span class="content">type</span><span class="delimiter">'</span></span>],
      <span class="local-variable">$options</span>[<span class="string"><span class="delimiter">'</span><span class="content">cache</span><span class="delimiter">'</span></span>][<span class="string"><span class="delimiter">'</span><span class="content">frontend</span><span class="delimiter">'</span></span>][<span class="string"><span class="delimiter">'</span><span class="content">options</span><span class="delimiter">'</span></span>],
      <span class="local-variable">$options</span>[<span class="string"><span class="delimiter">'</span><span class="content">cache</span><span class="delimiter">'</span></span>][<span class="string"><span class="delimiter">'</span><span class="content">backend</span><span class="delimiter">'</span></span>][<span class="string"><span class="delimiter">'</span><span class="content">options</span><span class="delimiter">'</span></span>]
    );

    <span class="constant">Zend_Registry</span>::set(<span class="string"><span class="delimiter">'</span><span class="content">cache</span><span class="delimiter">'</span></span>, <span class="local-variable">$cache</span>);
    <span class="keyword">return</span> <span class="local-variable">$cache</span>;
  }
}
</pre></div>
</div>
 </figure></notextile></div>

<p>That’s all set. I used the caching for some REST service responses. So i will stick to that in this post as well. The class has a method for adding a cache object.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">public</span> <span class="keyword">function</span> <span class="function">setCache</span>(<span class="constant">Zend_Cache_Core</span> <span class="local-variable">$cache</span>) {
  <span class="local-variable">$this</span>-&gt;cache = <span class="local-variable">$cache</span>;
}
</pre></div>
</div>
 </figure></notextile></div>

<p>So fetching the cache instance and passing it to the REST client will look something like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="local-variable">$cache</span> = <span class="constant">Zend_Registry</span>::get(<span class="string"><span class="delimiter">'</span><span class="content">cache</span><span class="delimiter">'</span></span>);
<span class="local-variable">$cache</span>-&gt;setLifetime(<span class="integer">86400</span>);
            
<span class="local-variable">$client</span> = <span class="keyword">new</span> <span class="constant">Client</span>();
<span class="local-variable">$client</span>-&gt;setCache(<span class="local-variable">$cache</span>);
</pre></div>
</div>
 </figure></notextile></div>

<p>The first thing we do inside the calling method is set a unique key for the cache entry.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="local-variable">$cache_id</span> = <span class="string"><span class="delimiter">'</span><span class="content">getPage_</span><span class="delimiter">'</span></span> . <span class="local-variable">$this</span>-&gt;getDomain()
  . <span class="local-variable">$this</span>-&gt;getPageName()
  . <span class="local-variable">$this</span>-&gt;getCountry();
</pre></div>
</div>
 </figure></notextile></div>

<p>Then we check if the cache object is set. If that’s the case we check to see if the unique key is already available in the cache.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">if</span> (!<span class="predefined">isset</span>(<span class="local-variable">$this</span>-&gt;cache) || !(<span class="local-variable">$ret</span> = <span class="local-variable">$this</span>-&gt;cache-&gt;load(<span class="local-variable">$cache_id</span>))) {
</pre></div>
</div>
 </figure></notextile></div>

<p>If a value is returned from the cahce we will return it. If not then we will do the webservice call and store the return data in cache.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="local-variable">$ret</span> = <span class="local-variable">$this</span>-&gt;restClient-&gt;call(<span class="string"><span class="delimiter">'</span><span class="content">getPage</span><span class="delimiter">'</span></span>, <span class="predefined">array</span>());
    
<span class="keyword">if</span> (<span class="predefined">isset</span>(<span class="local-variable">$this</span>-&gt;cache)) {
  <span class="local-variable">$this</span>-&gt;cache-&gt;save(<span class="local-variable">$ret</span>, <span class="local-variable">$cache_id</span>);
}
</pre></div>
</div>
 </figure></notextile></div>

<p>The complete method looks something like this.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">protected</span> <span class="keyword">function</span> <span class="function">getPageFromWebservice</span>()
{
  <span class="local-variable">$cache_id</span> = <span class="string"><span class="delimiter">'</span><span class="content">getPage_</span><span class="delimiter">'</span></span> . <span class="local-variable">$this</span>-&gt;getDomain()
    . <span class="local-variable">$this</span>-&gt;getPageName()
    . <span class="local-variable">$this</span>-&gt;getCountry();

  <span class="keyword">if</span> (!<span class="predefined">isset</span>(<span class="local-variable">$this</span>-&gt;cache) || !(<span class="local-variable">$ret</span> = <span class="local-variable">$this</span>-&gt;cache-&gt;load(<span class="local-variable">$cache_id</span>))) {
    <span class="local-variable">$ret</span> = <span class="local-variable">$this</span>-&gt;restClient-&gt;call(<span class="string"><span class="delimiter">'</span><span class="content">getPage</span><span class="delimiter">'</span></span>, <span class="predefined">array</span>());

    <span class="keyword">if</span> (<span class="predefined">isset</span>(<span class="local-variable">$this</span>-&gt;cache)) {
      <span class="local-variable">$this</span>-&gt;cache-&gt;save(<span class="local-variable">$ret</span>, <span class="local-variable">$cache_id</span>);
    }
  }
  <span class="keyword">return</span> <span class="local-variable">$ret</span>;
}
</pre></div>
</div>
 </figure></notextile></div>

<p>That’s all. It’s pretty basic stuff. But so cool!</p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2010-01-29T13:26:19+01:00" pubdate data-updated="true">Jan 29<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2010/01/cache-data-with-zend-framework-and-memcached/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2010/01/drag-drop-uploads-with-xmlhttprequest2-and-php/">Drag & Drop Uploads With XMLHttpRequest2 and PHP</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>I finally had some time to read through my ever growing list must read items and play with some new software. While reading up on the new Firefox 3.6 i noticed it came with the new <a href="http://www.ideal.nl/">XMLHttpRequest</a> [<a href="http://www.w3.org/TR/XMLHttpRequest2/">2</a>] object based on the new <a href="http://dev.w3.org/2006/webapi/FileAPI/">file API</a>. And according to the new <a href="http://dev.w3.org/2006/webapi/FileAPI/">specs</a>. This would allow for easy file uploads. Now there’s been some <a href="http://hacks.mozilla.org/2009/12/uploading-files-with-xmlhttprequest/">examples</a> [<a href="http://arstechnica.com/open-source/news/2009/11/w3c-publishes-draft-of-new-file-api-spec.ars">2</a>] on the web already. But i just wanted to get my hands dirty.</p>

<p>The new XMLHttpRequest object makes is possible to send files in a few different formats. The most important being the binary format. The code for sending a request with XMLHttpRequest2 looks the same as the previous version. Except for sendAsBinary() in this case.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();
    
fileUpload = xhr.upload,
fileUpload.<span class="function">onload</span> = <span class="keyword">function</span>() {
  console.log(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sent!</span><span class="delimiter">&quot;</span></span>);
}
                                    
xhr.open(<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">upload.php</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>);
xhr.sendAsBinary(file.getAsBinary());
</pre></div>
</div>
 </figure></notextile></div>

<p>So let’s set things up for drag &amp; drop. We need a div that will be the main drop point. And we need some event listeners to catch the drag * drop events. Let start by creating the drop zone. For this we use two simple divs. The outer div will listen for the drag &amp; drop events. And the inner will catch the files.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">drop</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/div&gt;</span>
</pre></div>
</div>
 </figure></notextile></div>

<p>Now let’s create our upload code.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">var</span> upload = {
  <span class="function">setup</span> : <span class="keyword">function</span>() {},
  <span class="function">uploadFiles</span> : <span class="keyword">function</span>() {event}
}
window.addEventListener(<span class="string"><span class="delimiter">&quot;</span><span class="content">load</span><span class="delimiter">&quot;</span></span>, upload.setup, <span class="predefined-constant">false</span>);
</pre></div>
</div>
 </figure></notextile></div>

<p>The setup method will set all event listeners for drag &amp; drop. And register the upload handler.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">var</span> container = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">container</span><span class="delimiter">'</span></span>);
<span class="keyword">var</span> drop = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">drop</span><span class="delimiter">'</span></span>);
                
container.addEventListener(<span class="string"><span class="delimiter">&quot;</span><span class="content">dragenter</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(event) {
    drop.innerHTML = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
    event.stopPropagation();
    event.preventDefault();
  }, 
  <span class="predefined-constant">false</span>
);

container.addEventListener(<span class="string"><span class="delimiter">&quot;</span><span class="content">dragover</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(event) {
    event.stopPropagation(); 
    event.preventDefault();
  }, 
  <span class="predefined-constant">false</span>
);

container.addEventListener(<span class="string"><span class="delimiter">&quot;</span><span class="content">drop</span><span class="delimiter">&quot;</span></span>, upload.uploadFiles, <span class="predefined-constant">false</span>);
</pre></div>
</div>
 </figure></notextile></div>

<p>As you could see above. the uploadFiles() method gets a event returned from the drag &amp; drop action. This is where the new <a href="http://dev.w3.org/2006/webapi/FileAPI/">file APi</a> comes in play. To get to the file property we access the dataTransfer object.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">var</span> files = event.dataTransfer.files;
</pre></div>
</div>
 </figure></notextile></div>

<p>The actual uploading is easy as cake.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">for</span> (<span class="keyword">var</span> x = <span class="integer">0</span>; x &lt; files.length; x++) {

  <span class="keyword">var</span> file = files.item(x);
  <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();

  fileUpload = xhr.upload;
  fileUpload.<span class="function">onload</span> = <span class="keyword">function</span>() {
    console.log(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sent!</span><span class="delimiter">&quot;</span></span>);
  }
                        
  xhr.open(<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">upload.php</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>);

  xhr.setRequestHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cache-Control</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">no-cache</span><span class="delimiter">&quot;</span></span>);
  xhr.setRequestHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">X-Requested-With</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">XMLHttpRequest</span><span class="delimiter">&quot;</span></span>);
  xhr.setRequestHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">X-File-Name</span><span class="delimiter">&quot;</span></span>, file.fileName);
  xhr.setRequestHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">X-File-Size</span><span class="delimiter">&quot;</span></span>, file.fileSize);
  xhr.setRequestHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">multipart/form-data</span><span class="delimiter">&quot;</span></span>);
                                
  xhr.sendAsBinary(file.getAsBinary());
}
</pre></div>
</div>
 </figure></notextile></div>

<p>That’s it for the client side. There is however a small problem on the receiving side. When handling uploaded files in PHP we expect the <strong>$_FILES</strong> array to be populated. This is not the case when streaming files from the client to the server. To get the needed file information we set some headers on the client side <strong>X-File-Name</strong> and <strong>X-File-Size</strong>. And since the <strong>$_FILES</strong> are is empty. We need an other way to get the file contents. So we will use php://input streams for that.</p>

<p>The contents of upload.php look like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="predefined">require_once</span>(<span class="string"><span class="delimiter">'</span><span class="content">Streamer.php</span><span class="delimiter">'</span></span>);
    
<span class="local-variable">$ft</span> = <span class="keyword">new</span> <span class="constant">File_Streamer</span>();
<span class="local-variable">$ft</span>-&gt;setDestination(<span class="string"><span class="delimiter">'</span><span class="content">data/</span><span class="delimiter">'</span></span>);
<span class="local-variable">$ft</span>-&gt;receive();
</pre></div>
</div>
 </figure></notextile></div>

<p>With setDestination() the destination path for the uploaded files is set. And recieve() listens for any incoming files. Most of the magic is done in the recieve() method. So here’s the code.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="CodeRay">
  <div class="code"><pre>
<span class="keyword">public</span> <span class="keyword">function</span> <span class="function">receive</span>()
{
  <span class="keyword">if</span> (!<span class="local-variable">$this</span>-&gt;isValid()) {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="predefined-constant">Exception</span>(<span class="string"><span class="delimiter">'</span><span class="content">No file uploaded!</span><span class="delimiter">'</span></span>);
  }
        
  <span class="predefined">file_put_contents</span>(
    <span class="local-variable">$this</span>-&gt;_destination . <span class="local-variable">$this</span>-&gt;_fileName, 
    <span class="predefined">file_get_contents</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">php://input</span><span class="delimiter">&quot;</span></span>)
  );
    
  <span class="keyword">return</span> <span class="predefined-constant">true</span>;
}
</pre></div>
</div>
 </figure></notextile></div>

<p>I am impressed! This promises a lot of good. And offers some interesting options. Let’s hope all browsers implement this gem. I still have one issue though. I can’t get this to work in firefox under linux. The drag &amp; drop events do not seem to function properly with files being dragged from the desktop. anybody know why? </p>

<p>If you interested in the complete code. you can find it <a href="http://lenss.nl/code/dragDropUpload.tar.gz">here</a></p>

<p><strong>**Small update</strong>**
<a href="http://lenss.nl/2010/09/drag-drop-uploads-with-xmlhttprequest2-and-php-revised/">http://lenss.nl/2010/09/drag-drop-uploads-with-xmlhttprequest2-and-php-revised/</a></p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2010-01-25T01:02:38+01:00" pubdate data-updated="true">Jan 25<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/javascript/'>Javascript</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2010/01/drag-drop-uploads-with-xmlhttprequest2-and-php/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2009/12/end-year-notice/">End Year Notice</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>Have been working hard this week on <a href="http://kremermakelaars.nl">kremermakelaars.nl</a>. And managed to finish it right before the end of this year. The old website was one of those left overs from the early 90’s. The only thing missing was a spinning @ sign. But i think i managed to give it a nice visual boost. For the back-end i created s nice CMS to manage all objects and page content. The whole thing is build with ZF, Mysql, and some javascript libraries.</p>

<p>The customer is happy. I’m happy. Now it’s time for some fun!</p>

<p>So that’s all for 2009. I wish everybody a good and happy new year.</p>

</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2009-12-31T11:38:33+01:00" pubdate data-updated="true">Dec 31<span>st</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/-home/'>/home</a>, <a class='category' href='http://lenss.nl/tag/freelance/'>Freelance</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2009/12/end-year-notice/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2009/12/a-new-hobby/">A New Hobby</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>A few months ago i got stranded on <a href="http://www.adafruit.com/">adda’s</a> website. This stuff looks so interesting. But thinking about building my own gives me sweaty hands. I love to build computers from scratch. But building a motherboard… i don’t see me doing that anytime soon. Even though i have null knowledge of the subject. I decided to give it shot anyway. And ordered the Russian Tube Clock. It arrived pretty fast. But occupied some closet space for at least 3 weeks. I however managed to push my self into building this thing. So here goes.</p>

<p>When you unpack the whole thing and lay it out on a table it looks pretty impressive. And at this point i got the feeling i would never get this to work. But thank god for the internet. I quickly found some nice hand held guides to <a href="http://0x.vc/4">guide</a> me through it.</p>

<p><img src="http://lenss.nl/images/2009/12/IMG_0550-1024x768.jpg" /></p>

<p>I will not bother you with all specifics. because i can’t :) And for that you should read <a href="http://www.adafruit.com/index.php?main_page=product_info&amp;cPath=39&amp;products_id=194">here</a> and <a href="http://www.ladyada.net/make/icetube/">here</a> Or just order the kit and give it a shot. it’s great. So after burning my self i managed to get the first set of components mounted properly on top of the PCB.</p>

<p><img src="http://lenss.nl/images/2009/12/IMG_0555-1024x768.jpg" /></p>

<p>The only problem i encountered (and it spoiled most of the project) was the soldering iron. Which was a mess to start of with. And it was way to big for this delicate work. The result was my soldering didn’t look that proper as you can see in the image below.</p>

<p><img src="http://lenss.nl/images/2009/12/IMG_0557-1024x768.jpg" /></p>

<p>The hardest part was to get the tube mounted correctly. One end of the tube is a spring of wires that need to be attached to a jack on the smaller PCB. It’s a time consuming and tedious job to do. But i think i managed. Although not all wires are as straight as they should have been.</p>

<p><img src="http://lenss.nl/images/2009/12/img_0611-1024x768.jpg" /></p>

<p>It finally starts to look like something. After hooking it up to some power and running some tests. I was ready to build the outer casing.</p>

<p><img src="http://lenss.nl/images/2009/12/img_0609-1024x768.jpg" /></p>

<p>The outer casing is a simple design. Done in Plexiglas. It looks simple. But it was a struggle to get the thing assembled.</p>

<p><img src="http://lenss.nl/images/2009/12/IMG_0563-1024x768.jpg" /></p>

<p>After my struggle with the casing i switched the tube on. And was greeted by a nice blue/greenish color and a beep. The color is a bit different from what is shown on the main site. But that has something to do with the tubes i read. The brightness is adjustable so that’s no problem. As you can see i still miss one time delimiter. And the menu is still not function 100%. But the clock works. And i can set the alarm. </p>

<p><img src="http://lenss.nl/images/2009/12/img_0608-1024x768.jpg" /></p>

<p>I had so much fun building this thing. that i ordered a new soldering iron. And will be doing a new attempt soon!</p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2009-12-20T22:46:10+01:00" pubdate data-updated="true">Dec 20<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/-home/'>/home</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2009/12/a-new-hobby/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2009/12/a-new-adventure-part-ii/">A New Adventure Part II</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>This post is a recap of a post i made earlier this month. Normally i would leave it as it is. But i wasn’t really happy with the outcome. And it didn’t really reflect the current situation. So here goes.</p>

<p>As the technological challenge in my current day to day job started to decline. I started to think this was not the right position for me. So i decided it was time to search for something new. And at that time i could not find anything interesting that didn’t include relocating my self to an other part of this world. This left me with a hard choice to make. But i left <a href="http://addmissions.nl/">AddMissions</a> anyway. With a good feeling though. I had have a great year there. Now was just time for a change.</p>

<p>All that was about two months ago. And for the past time i have been doing some <a href="http://bluesignal.nl/">freelance projects</a> to pay my bills. And although i enjoyed the time working from home. I feel it is time again to go and search for a new opportunity. I learned a lot from the past two months but freelance work is not something i tend to do full time. I need people around me. Even though i don’t talk that much while i work :)</p>

<p>I have some things cooking at the moment. Let’s see what the new year has to offer.</p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2009-12-20T22:10:44+01:00" pubdate data-updated="true">Dec 20<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/-home/'>/home</a>, <a class='category' href='http://lenss.nl/tag/freelance/'>Freelance</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2009/12/a-new-adventure-part-ii/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2009/12/0x-vc-url-shortener-service/">0x. Vc URL Shortener Service</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>Having a hard time getting to sleep tonight. And was browsing my domain list. when i realized i still have this very short domain name that is just sitting there collecting dust. And since these URl shortener services are so hot lately i decided to roll my own.</p>

<p>So three hours, a bit of code and a short domain name later i present : 0x.vc (it’s shorter) It’s probably still full of holes and prone to XSS attacks. So be careful!</p>

<p><strong>The URL shortening service is offline!</strong></p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2009-12-17T04:14:18+01:00" pubdate data-updated="true">Dec 17<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/freelance/'>Freelance</a>, <a class='category' href='http://lenss.nl/tag/javascript/'>Javascript</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2009/12/0x-vc-url-shortener-service/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2009/11/firefoxs-weird-black-borders/">Firefox&#8217;s Weird Black Borders</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>A few weeks a go i was working on a new blog to replace the current Wordpress software. The last two weeks however i had no time to work on it. So last night when i couldn’t sleep i loaded the site from my SVn repo. And when i opened it in firefox i was suprised to see some weird black borders around some page elements. After checking my CSS i confirmed  it was not created by any CSS on the page. </p>

<p><a href="http://lenss.nl/images/2009/11/blackline.jpg"><img src="http://lenss.nl/images/2009/11/blackline-300x292.jpg" alt="blackline" /></a></p>

<p>After an hour i got frustrated and went to bed. So this morning i was looking at it. An noticed a horizontal scrollbar. That shouldn’t be there i thought. And when i looked closy at the images on the page they looked correlated. It was like the page was zoomed in. Then it hit me. Firefox has a new zoom function. So after hitting</p>

<p>View &gt; Zoom &gt; Reset</p>

<p>The page was back to normal. It’s minor issue. But maybe it will help somebody from going crazy :)</p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2009-11-07T11:11:16+01:00" pubdate data-updated="true">Nov 7<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2009/11/firefoxs-weird-black-borders/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  <div class="blog-navigation">
    
      <div class="alignleft"><a class="prev" href="http://lenss.nl/page/9/">&larr; Older</a></div>
    
    
    <div class="alignright"><a class="next" href="http://lenss.nl/page/7/">Newer &rarr;</a></div>
    
  </div>
  <div class="blog-copy">
      Copyright &copy; 2013 - Thijs Lensselink -
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  </div>
</div>

	</div>
</div>

<div id="sidebar">
  
    
<div id="logo" class="sidebox">
	<div id="logo-main">lenss<span class="nl">nl</span></div>
	<div id="logo-sub"><span class="nl">Thijs Lensselink's Blog</span></div>
</div>

<div class="sidebox">
	<a href="http://www.facebook.com/thijs.lensselink#!/" class="social facebook"></a>
	<a href="https://plus.google.com/117496548747841671883" class="social google"></a>
	<a href="http://twitter.com/tlenss" class="social twitter"></a>
	<a href="http://feeds.feedburner.com/ThijsLensselinksBlog" class="social rss"></a>
	<div style="clear:both;"></div>
</div>

<div class="sidebox">
	<h1>Me</h1>
	<div class="me">
		<a href="http://www.zend.com/store/education/certification/yellow-pages.php#show-ClientCandidateID=ZEND006598"><img src="http://lenss.nl/images/php5-zce-logo-new.gif" height="58" /></a>
		<a href="http://stackoverflow.com/users/476697/tlenss">
			<img src="http://stackoverflow.com/users/flair/476697.png?theme=dark" width="208" height="58" alt="profile for tlenss at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for tlenss at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
		</a>
		<a href="http://internetdefenseleague.org"><img src="http://internetdefenseleague.org/images/badges/final/footer_badge.png" alt="Member of The Internet Defense League" height="58" /></a>
		<div class="gpg">
			Key ID : <a href="http://lenss.nl/FE0B2B46.asc">0xFE0B2B46</a><br/>
			Fingerprint : 4826 0FA9 AC98 CE61 BB3D  4046 D6EE FEED FE0B 2B46
		</div>
	</div>
</div>

<section>
  <div class="sidebox">
	<h1>Recent entries</h1>
	<ul class="linklist">
		
		<li><a href="http://lenss.nl/2013/08/github-and-multiple-ssh-keys/"><span class="higlight">August, 2013</span> Github, SSH and multiple repositories</a></li>
		
		<li><a href="http://lenss.nl/2013/07/memory-exhaust-issue-PHP-and-APM/"><span class="higlight">July, 2013</span> Memory exhaust issue PHP and APM</a></li>
		
		<li><a href="http://lenss.nl/2013/06/php-55-released/"><span class="higlight">June, 2013</span> PHP 5.5.0 released</a></li>
		
		<li><a href="http://lenss.nl/2013/03/casting-weirdness-with-PHP/"><span class="higlight">March, 2013</span> Casting weirdness with PHP</a></li>
		
		<li><a href="http://lenss.nl/2013/02/zend-optimizer%2B-integrated-in-5.5/"><span class="higlight">February, 2013</span> Zend Optimizer+ integrated into 5.5</a></li>
		
		<li><a href="http://lenss.nl/2013/02/phpness-serious-wtf/"><span class="higlight">February, 2013</span> PHPness Serious WTF</a></li>
		
		<li><a href="http://lenss.nl/2012/11/publish-google-reader-shared-items/"><span class="higlight">November, 2012</span> Publish Google Reader shared items</a></li>
		
		<li><a href="http://lenss.nl/2012/10/long-running-php-script-and-mysql-server-gone-away/"><span class="higlight">October, 2012</span> Long running PHP script and MySQL server gone away</a></li>
		
		<li><a href="http://lenss.nl/2012/10/git-rebase-on-pull-by-default/"><span class="higlight">October, 2012</span> Git: Rebase on pull by default</a></li>
		
		<li><a href="http://lenss.nl/2012/10/workaround-ubuntu-12-04-mysterious-system-freezes/"><span class="higlight">October, 2012</span> Workaround Ubuntu 12.04 mysterious system freezes</a></li>
		
	</ul>
</div>
</section>

<div class="sidebox ad">
	<script type="text/javascript"><!--
	google_ad_client = "ca-pub-0921745317573569";
	/* nlblue_side */
	google_ad_slot = "7706621160";
	google_ad_width = 300;
	google_ad_height = 250;
	//-->
	</script>
	<script type="text/javascript"
	src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
	</script>
</div>
<div class="sidebox">
	<h1>Tags</h1>
	<ul id="tag-cloud" class="blocklist"><a href='http://lenss.nl/tag/-home' style='font-size: 116.41025641025641%'>/home(32)</a> <a href='http://lenss.nl/tag/code' style='font-size: 160.0%'>Code(117)</a> <a href='http://lenss.nl/tag/design' style='font-size: 103.07692307692308%'>Design(6)</a> <a href='http://lenss.nl/tag/freelance' style='font-size: 102.05128205128204%'>Freelance(4)</a> <a href='http://lenss.nl/tag/git' style='font-size: 100.51282051282051%'>Git(1)</a> <a href='http://lenss.nl/tag/google' style='font-size: 101.53846153846153%'>Google(3)</a> <a href='http://lenss.nl/tag/javascript' style='font-size: 104.1025641025641%'>Javascript(8)</a> <a href='http://lenss.nl/tag/jquery' style='font-size: 101.02564102564102%'>Jquery(2)</a> <a href='http://lenss.nl/tag/magento' style='font-size: 101.02564102564102%'>Magento(2)</a> <a href='http://lenss.nl/tag/php' style='font-size: 134.35897435897436%'>PHP(67)</a> <a href='http://lenss.nl/tag/security' style='font-size: 104.1025641025641%'>Security(8)</a> <a href='http://lenss.nl/tag/sql' style='font-size: 103.07692307692308%'>SQL(6)</a> <a href='http://lenss.nl/tag/tech' style='font-size: 150.25641025641025%'>Tech(98)</a> <a href='http://lenss.nl/tag/zend' style='font-size: 104.1025641025641%'>Zend(8)</a> </ul>
	<div style="clear:both;"></div>
</div>
<section>
  <div class="sidebox">
	<h1>GitHub Repos</h1>
	
	<ul class="linklist" id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/tlenss" class="github-follow-button">Follow On GitHub</a>
  <script type="text/javascript" src="http://octophile.com/widgets.js"></script>
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = 'http://lenss.nl/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'tlenss',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="http://lenss.nl/javascripts/github.js" type="text/javascript"> </script>
</div>
</section>

<section>
  <div class="sidebox">
	<h1>Latest Tweets</h1>
	<script type="text/javascript">
  //$(document).ready(function(){
    //new AdnTimeline();
  //});
</script>

<div data-username="tlenss" data-avatars="true" data-count="5" class="adn-timeline"></div>
</div>
</section>


  
</div>

<a href="http://internetdefenseleague.org"><img src="http://internetdefenseleague.org/images/badges/final/banner_right.png" alt="Member of The Internet Defense League" /></a>

<footer role="contentinfo">
</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tlenss';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
