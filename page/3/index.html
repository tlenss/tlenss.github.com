
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Thijs Lensselink's Blog</title>
  <meta name="author" content="Thijs Lensselink">

  
  <meta name="description" content="PHP Critical Bug CVE-2012-0830 Ok it’s a bit late But i have been laying under a rock for the last week. And i guess it can’t hurt! Last week a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lenss.nl/page/3/">
  <link href="http://lenss.nl/favicon.png" rel="icon">
  <link href="http://lenss.nl/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="http://lenss.nl/javascripts/libs/jquery-1.8.1.js"></script>
  <script src="http://lenss.nl/javascripts/modernizr-2.0.js"></script>
  <script src="http://lenss.nl/javascripts/ender.js"></script>
  <script src="http://lenss.nl/javascripts/octopress.js"></script>
  <script src="http://lenss.nl/javascripts/github.js"></script>
  <script src="http://lenss.nl/javascripts/twitter.js"></script>
  <link href="http://feeds.feedburner.com/ThijsLensselinksBlog" rel="alternate" title="Thijs Lensselink's Blog" type="application/atom+xml">
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8003524-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <script type="text/javascript">
	$(document).ready(function() {
		$('#logo').click(function() {
			window.location = '/';
		});
	});
  </script>
</head>

<body   >
<div id="content">
	<div class="inner">
        <div class="blog-index">
  
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2012/02/php-critical-bug-cve-2012-0830/">PHP Critical Bug CVE-2012-0830</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>Ok it’s a bit late But i have been laying under a rock for the last week. And i guess it can’t hurt!</p>

<p>Last week a critical bug was discovered in PHP. Which affects versions 5.3.9 and 5.2.17. The bug could be exploited to run arbitrary code on a remote PHP system. So upgrade your systems. And of course Stefan Esser <a href="http://news.php.net/php.internals/57655">popped up</a> with some wise words :)… O well i still think the guy does great work.</p>

<p>More info about the issue can be found on packetstorm (<a href="http://packetstormsecurity.org/files/cve/CVE-2012-0830">CVE-2012-0830</a>) </p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2012-02-05T13:39:43+01:00" pubdate data-updated="true">Feb 5<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/security/'>Security</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2012/02/php-critical-bug-cve-2012-0830/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2011/11/php-getting-strict-sessions/">PHP Getting Strict Sessions</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>For years <a href="http://php.net/">PHP</a> has been vulnerable to session adoption which can enable <a href="http://en.wikipedia.org/wiki/Session_fixation">session fixation</a>. And since sessions are a major part of web applications now a days. A lot of platforms are open and waiting for an attack to happen.</p>

<p><strong>session adoption &amp; session fixation</strong></p>

<p>The problem exists because the current session module does not validate the session id that comes in from a cookie. This means uninitialized session id’s can be passed by the client. This happens due to the fact that browsers overwrite cookie if multiple cookies are send per request.
Some people would say this is solvable by implementing <a href="http://nl3.php.net/manual/en/function.session-regenerate-id.php">session_regenerate_id()</a>. But this is not the case.</p>

<p>Because session fixation can be used to take over control of web applications. Validation is required when multiple cookies are send per request. When multiple cookie are send with a request. Browsers send multiple cookies without domain / path information. This way it’s impossible to tell which cookie belongs to which domain. </p>

<p><strong>So how do we fix this?</strong></p>

<p>There is some userland code that does offer the ability to validate session data. But this has not been widely adopted by other developers.</p>

<p>Code that adds the session ID as a validation key:</p>

<pre><code>session_destory();
session_regenerate_id();
$_SESSION['valid_id'] = session_id(); 
</code></pre>

<p>And the code to check if the session was properly initialized:</p>

<pre><code>if ($_SESSION['valid_id'] !== session_id()) {
  die('Invalid use of session ID');
}
</code></pre>

<p>Thank god the internal developer know this. And are working to fix this. For the past days there has been an interesting discussion going on on the <a href="http://news.php.net/php.internals">internals</a> list. About applying a patch that will fix this. The patch will add some new php.ini features and a new method validate_id() for the session save handler. Hopefully this will be available in version 5.4.</p>

<p>To not break BC strict_mode will be disabled by default. But can be enabled by setting the following setting in php.ini. When enabled uninitialized session ID will be discarded.</p>

<blockquote>
  <p>session.use_strict_mode=0</p>
</blockquote>

<p>To prevent a DoS instead of session fixation. An new feature has been added that deletes possible malicious cookies that prevent new session ID.</p>

<blockquote>
  <p>session.safe_session_cookie=1</p>
</blockquote>

<p>You can read more about session fixation and the upcoming patch on the <a href="https://wiki.php.net/rfc/strict_sessions">PHP-Wiki</a></p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2011-11-30T15:38:28+01:00" pubdate data-updated="true">Nov 30<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/security/'>Security</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>, <a class='category' href='http://lenss.nl/tag/zend/'>Zend</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2011/11/php-getting-strict-sessions/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2011/11/abbywinters-com-is-hiring/">Abbywinters.com Is Hiring!</a></h1>
	
	</header>
</header>


  <div class="articletext"><p><a href="http://careers.abbywinters.com/job-opportunities/senior-php-developer/"><img src="http://lenss.nl/images/2011/11/aw-logo-roundel-blue.png" alt="" /></a> If you’re looking for a new challenging and exiting Senior Webdeveloper position. Don’t look any further. If you already think you have the job of your dreams. Think again!</p>

<p><em><a href="http://www.abbywinters.com">abbywinters.com</a> <strong>(NSFW)</strong> is one of the largest and most ethical, highly rated, well designed, and successful erotic websites in the world today. abbywinters.com is the WINNER of the AVN 2011 Awards for Best Membership site!</em></p>

<p>And we are looking to hire a new talented webdeveloper to expand our small team. What would you think about joining our small Agile team of highly qualified professionals? </p>

<p>You will be creating sexy, exiting and game changing experiences for the web, work for one of the industry leaders. And just be part of an awesome company. Some of the jobs key elements are:</p>

<ul>
  <li>
    <p>Implementing development projects</p>
  </li>
  <li>
    <p>Leading informal mentoring during day-to-day work</p>
  </li>
  <li>
    <p>Contribute to design of development projects</p>
  </li>
  <li>
    <p>Track, reduce, and prevent technical debt in Web Development projects</p>
  </li>
</ul>

<blockquote>
  <p>Motivated by principles of social responsibility, we deliver provocative media by embracing imagination, creativity and emerging technologies. Our models, customers and business partners are inspired by our fervid passion.</p>

</blockquote>

<blockquote>

  <p>Our experienced staff use state-of-the-art content production facilities to produce 10 shoots a week from concept to finished art, utilizing the most advanced digital capture, post production and delivery systems in the world.</p>

</blockquote>

<blockquote>

  <p>You will be working directly with our Web Dev Manager, Lead developer and colleagues in the web dev team. We need each individual to contribute for us to continue as a pioneer in our industry.</p>
</blockquote>

<p>If you posses a “Can do” attitude. Would like to work in the center of Amsterdam. And are able to identify your self in the criteria below. You might want to head over to our <a href="http://careers.abbywinters.com/job-opportunities/senior-php-developer/">career portal</a> for a more detailed description.  </p>

<p><strong>Technical competencies – Required</strong></p>

<ul>
  <li>
    <p>High level of skill with PHP 5</p>
  </li>
  <li>
    <p>High level of skill with Object Oriented Programming</p>
  </li>
  <li>
    <p>High level of skill with HTML/CSS</p>
  </li>
  <li>
    <p>High level of skill with JavaScript</p>
  </li>
  <li>
    <p>High level of skill with Internet Applications</p>
  </li>
  <li>
    <p>Moderate level of skill with Unit Testing and Test Driven Design</p>
  </li>
  <li>
    <p>Moderate level of skill with MySQL</p>
  </li>
  <li>
    <p>Moderate level of skill with Windows XP operating system</p>
  </li>
  <li>
    <p>Experience with the GNU/Linux operating system</p>
  </li>
  <li>
    <p>Competent with Revision Control systems (Subversion)</p>
  </li>
  <li>
    <p>Bachelor of Science in Computer Science, or equivalent experience</p>
  </li>
  <li>
    <p>Zend Certified Engineer, or equivalent experience</p>
  </li>
  <li>
    <p>At least 5 years experience in Web Application Development</p>
  </li>
</ul>

<p><strong>Technical competencies – Desired</strong></p>

<ul>
  <li>
    <p>Moderate level of skill with the Apache HTTP server</p>
  </li>
  <li>
    <p>Good understanding of the Model-View-Controller pattern</p>
  </li>
  <li>
    <p>Good understanding of the ActiveRecord Object-Relational-Mapping pattern</p>
  </li>
  <li>
    <p>Familiarity with Agile software development practices (Scrum)</p>
  </li>
  <li>
    <p>E-commerce</p>
  </li>
  <li>
    <p>Agile development experience</p>
  </li>
</ul>

</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2011-11-22T14:46:51+01:00" pubdate data-updated="true">Nov 22<span>nd</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/javascript/'>Javascript</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/sql/'>SQL</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2011/11/abbywinters-com-is-hiring/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2011/11/ubuntu-11-10-issues-after-fresh-install/">Ubuntu 11.10 Issues After Fresh Install</a></h1>
	
	</header>
</header>


  <div class="articletext"><p><strong>Update: 13-11-2011</strong></p>

<p>I decided to give Ubuntu another try. After downloading and burning a fresh image. I did a clean install. And this time the result was a lot better then the first time. Maybe i just had a bad disk.</p>

<p>Unity still caused me issues. Mainly because i am running a dual monitor setup. And i wan to use a TwinView setup. This just does not seem to work at the moment. So i install GNOME Shell. And that seems to work a lot smoother with two screens. Even my sound issues have been resolved magically. Maybe i should stick with Ubuntu a bit longer.</p>

<p><del>This weekend i decided to finally try to upgrade Ubuntu to the latest version (11.10). And since the upgrade process was not working out for me. I had no other choice but to do a clean install. No problem. It was time for a clean install anyway.</del></p>

<p><del>After fighting my way through a pile of bad rewritable DVDs i finally managed to write to disc that didn’t halt in the middle of the install process. And finished the install quite quickly. No problem there.</del></p>

<p><del>The <a href="https://launchpad.net/lightdm">Lightgdm</a> greeting instead of the old <a href="http://projects.gnome.org/gdm/">GDM</a> interface was nice. I logged in. And then it hit me. O shit they hooked Ubuntu up with the <a href="http://unity.ubuntu.com/">Unity</a> interface. The last time i upgraded Ubuntu that was the first thing i disabled. But my second screen wasn’t activated. So i decided to install the Nvidia drivers first. And then did a reboot.</del></p>

<p><del>After the system came back up. The desktop environment didn’t load anymore. And if i waited long enough the whole system would crawl to a halt. Damn! At this point i was getting sleepy. And didn’t want to spend the whole night poking around the system trying to fix this. So a bit of Google magic later i found <a href="http://blog.al4.co.nz/2011/10/slow-desktop-performance-on-ubuntu-11-10-with-nvidia-graphics-cards/">this</a>. Some issues related to the current Nvidia driver. So i upgraded to the 285.05 version</del></p>

<p><del></del></p>

<blockquote>
  <p>$ sudo bash
$ add-apt-repository ppa:ubuntu-x-swat/x-updates
$ apt-get update &amp;&amp; apt-get upgrade
$ reboot</p>
</blockquote>

<p>&lt;/del&gt;</p>

<p><del>And after a reboot the desktop was fine again. Nice!</del></p>

<p><strong>World of Warcraft</strong></p>

<p>After that i installed wine and copied back the old files i already had installed previously. But World of Warcraft didn’t want to start anymore. And although i planned not to play for a while. This got me poking around. And of course couldn’t find a solution. So i downloaded a new game client from battle.net. And started a fresh install. But when the launcher came up. It crashed just like before. Tried it a couple more times. When i noticed it was crashing starting the download. SO i started poking around in the download settings. And disabled peer-to peer. And voila! It started working for me again.</p>

<blockquote>
  <p>Options &gt; Downloader Preferences 
(uncheck ¨Enable peer-to-peer Transfer¨)</p>
</blockquote>

<p><del><strong>Lets remove Unity!</strong></del></p>

<p><del>Although i kind alike the <a href="http://unity.ubuntu.com/">Unity</a> interface. It wasn’t running smoothly. And i was having some serious CPU load issues. So i decided to remove it once again. This time. It wasn’t as easy though. I followed the steps in <a href="http://linux-software-news-tutorials.blogspot.com/2011/10/ubuntu-1110-oneiric-remove-unity-and.html">this</a> post. Only to come to the realization that its <a href="http://www.gnome.org/gnome-3/">Gnome 3</a> i´m dealing with and not Gnome2. O well lets give it a try. </del></p>

<p><del>So after messing with the themes a bit. I got the normal look back. Now the only thing annoying left is the bottom bar. That has to go. And preferably moved to the second screen. This was surprisingly easy for a change. Start up DConfig Editor from the Applications menu. And navigate to.</del></p>

<p><del></del></p>

<blockquote>
  <p>org &gt; gnome &gt; gnome-panel &gt; layout &gt; toplevels</p>
</blockquote>

<p>&lt;/del&gt;</p>

<p><del>(then change)</del></p>

<blockquote>
  <p>monitor : 1
orientation : top</p>
</blockquote>

<p>&lt;/del&gt;</p>

<p><del>And fix the freaking <a href="http://askubuntu.com/questions/69306/tilde-and-double-quote-keys-dont-work-on-the-command-line">keyboard</a></del></p>

<p><del>Sound still makes a crackling noise!</del></p>

<p><del>But at least i have a desktop that looks reasonably the same as my old and trusted Gnome2 one did. </del></p>

<p><a href="http://lenss.nl/images/2011/11/Screenshot-at-2011-11-06-231619.png"><img src="http://lenss.nl/images/2011/11/Screenshot-at-2011-11-06-231619-300x93.png" alt="" /></a></p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2011-11-07T00:26:27+01:00" pubdate data-updated="true">Nov 7<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/-home/'>/home</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2011/11/ubuntu-11-10-issues-after-fresh-install/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2011/10/lack-of-better-content/">Lack of Better Content</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>Just something funny for a change ;)</p>

<p><a href="http://lenss.nl/images/2011/10/Screenshot.png"><img src="http://lenss.nl/images/2011/10/Screenshot-300x235.png" alt="" /></a></p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2011-10-08T12:58:14+02:00" pubdate data-updated="true">Oct 8<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/-home/'>/home</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2011/10/lack-of-better-content/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2011/09/the-current-state-of-ssl-and-the-future-of-authenticity/">The Current State of SSL and the Future of Authenticity</a></h1>
	
	</header>
</header>


  <div class="articletext"><p><a href="http://convergence.io/"><img src="http://lenss.nl/images/2011/09/convergence.png" alt="" /></a> Last week i had a blast while listening to <a href="http://www.thoughtcrime.org/">Moxie Marlinspike’s</a> Blackhat talk <a href="http://www.youtube.com/watch?v=Z7Wl2FW2TcA">the past and future of SSL</a>. The video is an absolute must see if you have any concern about the current state of SSL or the whole web for that matter.</p>

<p>As many know. There has been quite the turmoil in the SSL world lately with some big CA’s (<a href="http://www.comodo.com">Comodo</a>, <a href="http://www.startcom.org/">StartCom</a>, <a href="http://www.diginotar.com/">Diginotar</a>, <a href="http://www.globalsign.com/">GlobalSign</a>) getting hacked. And rogue certificates being generated for major domains like microsoft.com, google.com, etc for who knows what type of malicious purpose. The real problem here are the centralized CA’s. For SSL to work you need to explicitly trust the major CA’s. And if one gets hacked. Well.. we know the deal by now. And the funny thing is that Moxie mentions in his talk. The whole CA wasn’t even part of the original SSL protocol. As the creator of SSL said “It’s something we through in at the end”.</p>

<p>But instead of only bashing the CA’s. Moxie comes with a solution to the problem. In the form of a new protocol <a href="http://convergence.io/">Convergence</a>, Which exists of a client and a server package. The client right now is a simple Firefox extension. And when installed it disables the current CA system in the browser. And will use one or more of the selected notaries instead. It even works with self signed certificates. And the back-end is a modular one. And the standard CA verification can be swapped with for instance <a href="http://www.dnssec.net/">DNSSEC</a> based verification.</p>

<p>There is still a level of trust involved. But you won’t lay all your trust in one specific CA. Convergence uses notaries. Notaries are anonymous nodes that can be picked at will and can be used to verify the requested certificate. And like i said the notaries are anonymous. No more browser leakage at this point. One of th notaries will act as a bounce node to which a SSL connection is made. All other notaries are contacted through this secure connection.</p>

<p>I am probably not the best person to explain this all. So go ahead and listen/watch <a href="http://www.youtube.com/watch?v=Z7Wl2FW2TcA">Moxie’s talk</a> and form your own opinion. But i think everybody should install <a href="http://convergence.io/">this</a> Firefox plugin. And forget about the whole CA system. I went ahead and installed a notary node myself. Which can be found <a href="http://lenss.nl/lenssnl.notary">here</a>. More information about setting up a notary node yourself can be found <a href="https://github.com/moxie0/Convergence/wiki/Running-a-Notary">here</a></p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2011-09-12T02:13:33+02:00" pubdate data-updated="true">Sep 12<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/security/'>Security</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2011/09/the-current-state-of-ssl-and-the-future-of-authenticity/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2011/09/php-slow-on-32-bit-ubuntu/">PHP Slow on 32-bit Ubuntu</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>My last <a href="http://lenss.nl/2011/08/php5-filesize-limit-on-32-bit-system/">post</a> was about the 32-bit integer issue i was having with PHP. And besides setting up a 64-bit server one of the solutions is to compile PHP with the CFLAGS mentioned in my previous post. </p>

<p>Intrigued by the fact that my 32-bit Ubuntu installation did not suffer from the same issue. I started to read the PHP5 changelog for Ubuntu.</p>

<blockquote>

  <p>CFLAGS=”-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64″ ./configure</p>
</blockquote>

<p>But this has a negative side effect. Namely PHP running 50% slower then it should be. And to my surprise Ubuntu applies the CFLAGS above when compiling PHP5 for a 32-bit platform. So that would mean PHP on Ubuntu is always running 50% slower? Well according to <a href="https://bugs.php.net/bug.php?id=45942">this</a> is should be the case. </p>

<p>I downloaded <a href="http://nl.php.net/get/php-5.3.8.tar.gz/from/a/mirror">php-5.3.8</a> from php.net and compiled two versions. One with the CFLAGS set for large files. And one normal without any changes. After that i downloaded the benchmark script from <a href="http://www.php-benchmark-script.com">php-benchmark-script.com</a>. And did a couple of runs on each of the two installs. The results are stunning.</p>

<p><strong>PHP-5.3.8 compiled with large file support:</strong></p>

<blockquote>
  <p>test_math                 : 4.414 sec.
test_stringmanipulation   : 4.968 sec.
test_loops                : 3.529 sec.
test_ifelse               : 2.344 sec.
————————————–
Total time:               : 15.255 sec.</p>
</blockquote>

<p><strong>PHP-5.3.8 compiled without large file support:</strong></p>

<blockquote>
  <p>test_math                 : 2.274 sec.
test_stringmanipulation   : 2.286 sec.
test_loops                : 1.619 sec.
test_ifelse               : 1.228 sec.
————————————–
Total time:               : 7.407 sec.</p>
</blockquote>

<p>That’s pretty much a 50% speed decrease. One more thing i tried is adding the ‘AC_SYS_LARGEFILE’ macro to configure.in and rebuild the configure script. But this had no effect at all.</p>

<blockquote>
  <p>$ cd php-5.3.8 
$ vi configure.in (add AC_SYS_LARGEFILE somewhere)
$ export PHP_AUTOCONF=/usr/share/autoconf2.59
$ ./buildconf –force</p>
</blockquote>

<p>I then tried two things. First i build without the CFLAGS. But this didn’t seem to do much. Then i used the same configure script with the CFLAGS for large file support. But there was no speed increase measurable. </p>

<p>So why would Ubuntu have made the choice to compile PHP with the large file support on a 32-bit platform? Are there really that much developers that work on large files in web / cli applications written in PHP? Enough to sacrifice a 50% speed decrease?</p>

<p>I don’t really know the answer to that. But i will do my large file processing on 64-bit machines. And will compile PHP from scratch from now on. Until i have upgraded my aging hardware.</p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2011-09-07T14:09:44+02:00" pubdate data-updated="true">Sep 7<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2011/09/php-slow-on-32-bit-ubuntu/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2011/08/php5-filesize-limit-on-32-bit-system/">PHP5 Filesize Limit on 32-bit System</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>So we have a PHP based importer script that does some heavy duty media processing at the office. And i had to import some new media today. But for some reason a couple of files weren’t picked up without a message. So i cleaned up the upload folder. The only files left were the files not being processed. And when i started the importer. The result was.</p>

<blockquote>

  <p>Importer found (0) files to import!</p>
</blockquote>

<p>Hmmm. That’s not right. So i had a look at the code behind the importer. Which basically is a loop using a <a href="http://nl2.php.net/manual/en/class.directoryiterator.php">DirectoryIterator</a> object. And some var_dump calls revealed the issue. For some reason <a href="http://nl2.php.net/manual/en/splfileinfo.isfile.php">-&gt;isFile()</a> was returning <em>(false)</em> for regular files. WTF! Let’s test that on the command line.</p>

<blockquote>
  <p>$ php -r “var_dump(is_file(‘/some/file.ext’));”;
<em>bool(false)</em></p>
</blockquote>

<p>Ok so we have an issue here. How big are these files really. A inspection revealed they are all over 2GB. Maybe some 32 bit issue? As the platform the code is running on is a 32 bit server. So i asked my colleagues, Googled a bit and read through php.net. To find out that there is an issue with PHP and files larger then 2GB.</p>

<blockquote>
  <p><a href="https://bugs.php.net/bug.php?id=27792">https://bugs.php.net/bug.php?id=27792</a>
<a href="https://bugs.php.net/bug.php?id=48886">https://bugs.php.net/bug.php?id=48886</a>
<a href="http://nl.php.net/manual/en/function.filesize.php">http://nl.php.net/manual/en/function.filesize.php</a></p>
</blockquote>

<p>Those however all seem related to filesize. The filesize function manual page even has a note about it. Maybe it’s related?</p>

<blockquote>
  <p><strong>Note:</strong> Because PHP’s integer type is signed and many platforms use 32bit integers, <strong>filesize() ** may return unexpected results for files which are larger than **2GB</strong>. For files between 2GB and 4GB in size this can usually be overcome by using <strong>sprintf(“%u”, filesize($file))</strong>. </p>
</blockquote>

<p>But i can’t apply that patch on a production server. So i came up with a simple solution for now. I extended the <a href="http://nl2.php.net/manual/en/class.directoryiterator.php">DirectoryIterator</a> class and have overwritten the <em>isFile</em> method. Which works for now (don’t think this will work on windows).</p>

<pre><code>Class MyDirectoryIterator extends DirectoryIterator {
	public function isFile() {
		return (integer) exec("[ -f {$this-&gt;getPathname()} ] &amp;&amp; echo 1 || echo 0");
	}
}
</code></pre>

<p>Convinced it was a 32 bit issue. I came home later that day. And wanted to try it out on my own desktop. That is a 32 bit system and runs Ubuntu 11.04. To my surprise the result was different then i expected.</p>

<blockquote>
  <p>$ php -r “var_dump(is_file(‘/some/file.ext’));”;
<em>bool(true)</em></p>
</blockquote>

<p>I used the same files as before. And tested some more big files. But the result was the same. Weird. Let’s try some other 32 bit machines.</p>

<blockquote>
  <p>Ubuntu 11.04: bool(true)</p>
</blockquote>

<p>CentOS release 5.6 (Final): bool(false)
Debian 6.0.2 (squeeze): bool(false)</p>

<p>Only my desktop at home seems to have a good result. Ubuntu must have some patch somewhere to fix this issue? To confirm i compiled PHP 5.3.8 from source. And did the same test again on Ubuntu 11.04. And this time it was <em>(false)</em>.</p>

<blockquote>
  <p>$ php -r “var_dump(is_file(‘/some/file.ext’));”;
<em>bool(false)</em></p>
</blockquote>

<p>I am not really in the mood to search the Ubuntu <a href="http://changelogs.ubuntu.com/changelogs/pool/main/p/php5/">changelog</a>. And for now the work around will do. But i really would like to know what patch is applied to resolve the issue.</p>

<p><strong>[ update ]</strong></p>

<p>While applying the patch for the is_file issue. I was confronted with the fact that way more function calls cause issues. So while waiting for PHP to get patched i had to create some workarounds for the time being.</p>

<p>Getting the filesize:</p>

<pre><code>(integer) exec("stat -c%s {$file-&gt;getFilename()}");
</code></pre>

<p>Calculate a MD5 checksum:</p>

<pre><code>$md5 = exec("md5sum {$file-&gt;getFilename()}");
$expl = explode('\t', $md5);
return (string) $expl[0];
</code></pre>

<p>Calculate the CRC32 checksum:</p>

<pre><code>$hash = exec("cksum {$this-&gt;path}");
$expl = explode(' ', $hash);
return $expl[0];
</code></pre>

<p>Get the modified time:</p>

<pre><code>$stat = explode('.', exec("stat -c%y {$this-&gt;path}"));
$timestamp = strtotime($stat[0]);
return $timestamp;
</code></pre>

<p>Hopefully that will do for now. On a side note the issue is solvable by setting certain <strong>CFLAGS</strong> when compiling PHP. I have no idea what the impact of that will be on the PHP binary. But it does seem to solve the issue. Not sure how one would apply that when PHP is installed from the distro’s repository though.</p>

<blockquote>
  <p>CFLAGS=”-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64” ./configure</p>
</blockquote>

</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2011-08-31T01:38:00+02:00" pubdate data-updated="true">Aug 31<span>st</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>, <a class='category' href='http://lenss.nl/tag/zend/'>Zend</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2011/08/php5-filesize-limit-on-32-bit-system/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2011/08/jquery-unrecognized-expression-error/">Jquery Unrecognized Expression Error</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>While doing some front end work yesterday. I got trapped by a <a href="http://jquery.com/">jQuery</a> issue. Well not JQuery specific. The issue was actually triggered by some other hand crafted code. Every time i would click a link inside my grid view firebug would throw an error.</p>

<blockquote>
  <p>uncaught exception: Syntax error, unrecognized expression: .</p>
</blockquote>

<p>And the markup that triggered the error was</p>

<pre><code>&lt;a href="" class="zipDownload"&gt;&lt;span class="icon_zipSmall"&gt;&lt;/span&gt;&lt;/a&gt;
</code></pre>

<p>Nothing wrong there right? And it actually took my quite some time to figure this one out. It would be nice to have a tool that can tell you there are multiple click events assigned to a element? But for now it was just some manual searching and testing.</p>

<p>The issue was caused by an other snippet of Javascript code inside another .js file. This piece of code attached a click event to every div inside a grid td. Which may be a bit to greedy.</p>

<pre><code>$('.admin .gridbg tr td span').click(function() {
</code></pre>

<p>And my link was in a nested td inside the grid. And also contained a span tag. So it was actually firing off two click events. From which one failed. Fixing it after that was easy. Either make the first click binding less greedy. Or change the markup of my second grid. I choose the last one.</p>

<pre><code>&lt;a href="http://lenss.nl" class="zipDownload icon_zipSmall"&gt;&lt;/a&gt;
</code></pre>

</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2011-08-20T13:20:59+02:00" pubdate data-updated="true">Aug 20<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/design/'>Design</a>, <a class='category' href='http://lenss.nl/tag/javascript/'>Javascript</a>, <a class='category' href='http://lenss.nl/tag/jquery/'>Jquery</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2011/08/jquery-unrecognized-expression-error/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  
  <article>
  
<header>
	<header>
	
	  <h1 class="entry-title"><a href="http://lenss.nl/2011/08/php-locale-dates-adventure/">PHP Locale Dates Adventure</a></h1>
	
	</header>
</header>


  <div class="articletext"><p>About a week ago i was working on a twitter widget for a website. This required some dates to be displayed in Dutch. And i found out the hard way my knowledge on this has faded away over time.</p>

<p>So the code i was working on. Did something like this.</p>

<pre><code>$date = date('D M d H:i:s Y', strtotime($someVar));
</code></pre>

<p>My thought was that by setting the correct locale the dates would appear in the correct language. Wrong!</p>

<pre><code>date_default_timezone_set('Europe/Amsterdam');
setlocale(LC_ALL, 'nl_NL.utf8');
</code></pre>

<p>After a reload i was greeted by the same dates as before. In plain English. Oke no worries. Let’s see what setlocale returns.</p>

<pre><code>var_dump(setlocale(LC_ALL, 'nl_NL.utf8'));
</code></pre>

<blockquote>

  <p>bool(false)</p>
</blockquote>

<p>That’s not good. Seems like we are missing some locales on the server. Let’s check.</p>

<blockquote>
  <p>locale -a</p>
</blockquote>

<blockquote>
  <p>en_AG
en_AG.utf8
en_AU.utf8
en_BW.utf8
en_CA.utf8
en_DK.utf8
en_GB.utf8
en_HK.utf8
en_IE.utf8
en_IN
en_IN.utf8
en_NG
en_NG.utf8
en_NZ.utf8
en_PH.utf8
en_SG.utf8
en_US.utf8
en_ZA.utf8
en_ZW.utf8
…</p>
</blockquote>

<p>And some more output after that. But not the one i am looking for. But thankfully aptitude was kind enough to provide the missing language packages.</p>

<blockquote>
  <p>nl_NL
nl_NL@euro
nl_NL.iso88591
nl_NL.iso885915@euro
nl_NL.utf8</p>
</blockquote>

<p>So let’s set the correct locale for this script.</p>

<pre><code>setlocale(LC_ALL, 'nl_NL.utf8');
</code></pre>

<p>But still no changes. I must be missing something….. Let’s consult the <a href="http://www.php.net/manual/en/function.date.php">manual</a>. The last line in the <strong>examples</strong> section is what i was looking for</p>

<blockquote>
  <p>To format dates in other languages, you should use the <a href="http://www.php.net/manual/en/function.setlocale.php">setlocale()</a> and <a href="http://www.php.net/manual/en/function.strftime.php">strftime()</a> functions instead of date(). </p>
</blockquote>

<p>Duuh! Completely forgot about <a href="http://www.php.net/manual/en/function.strftime.php">strftime</a>. Let’s change the code.</p>

<pre><code>strftime('%a %b %d %H:%M:%S %Y', strtotime($somevar));
</code></pre>

<blockquote>
  <p>ma aug 15 14:55:06 2011</p>
</blockquote>

<p>Perfect. That did it. </p>
</div>
  
  


<div style="clear:both;"></div>

  <footer>
     <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2011-08-16T00:54:46+02:00" pubdate data-updated="true">Aug 16<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='http://lenss.nl/tag/code/'>Code</a>, <a class='category' href='http://lenss.nl/tag/php/'>PHP</a>, <a class='category' href='http://lenss.nl/tag/tech/'>Tech</a>
  
</span>


    </p>
    <div class="share">
		<ul>
			<li><a href="http://lenss.nl/2011/08/php-locale-dates-adventure/#disqus_thread">Comments</a></li>
		</ul>
	</div>
  </footer>
  </article>
  
  <div class="blog-navigation">
    
      <div class="alignleft"><a class="prev" href="http://lenss.nl/page/4/">&larr; Older</a></div>
    
    
    <div class="alignright"><a class="next" href="http://lenss.nl/page/2/">Newer &rarr;</a></div>
    
  </div>
  <div class="blog-copy">
      Copyright &copy; 2013 - Thijs Lensselink -
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  </div>
</div>

	</div>
</div>

<div id="sidebar">
  
    
<div id="logo" class="sidebox">
	<div id="logo-main">lenss<span class="nl">nl</span></div>
	<div id="logo-sub"><span class="nl">Thijs Lensselink's Blog</span></div>
</div>

<div class="sidebox">
	<a href="http://www.facebook.com/thijs.lensselink#!/" class="social facebook"></a>
	<a href="https://plus.google.com/117496548747841671883" class="social google"></a>
	<a href="http://twitter.com/tlenss" class="social twitter"></a>
	<a href="http://feeds.feedburner.com/ThijsLensselinksBlog" class="social rss"></a>
	<div style="clear:both;"></div>
</div>

<div class="sidebox">
	<h1>Me</h1>
	<div class="me">
		<a href="http://www.zend.com/store/education/certification/yellow-pages.php#show-ClientCandidateID=ZEND006598"><img src="http://lenss.nl/images/php5-zce-logo-new.gif" height="58" /></a>
		<a href="http://stackoverflow.com/users/476697/tlenss">
			<img src="http://stackoverflow.com/users/flair/476697.png?theme=dark" width="208" height="58" alt="profile for tlenss at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for tlenss at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
		</a>
		<div class="gpg">
			Key ID : <a href="http://lenss.nl/6AD79CEF.asc">0x6AD79CEF</a><br/>
			FP : FB53 B9D6 D7F1 9A16 1456 4DB3 3D35 402F 6AD7 9CEF
		</div>
	</div>
</div>

<section>
  <div class="sidebox">
	<h1>Recent entries</h1>
	<ul class="linklist">
		
		<li><a href="http://lenss.nl/2013/06/php-55-released/"><span class="higlight">June, 2013</span> PHP 5.5.0 released</a></li>
		
		<li><a href="http://lenss.nl/2013/03/casting-weirdness-with-PHP/"><span class="higlight">March, 2013</span> Casting weirdness with PHP</a></li>
		
		<li><a href="http://lenss.nl/2013/02/zend-optimizer%2B-integrated-in-5.5/"><span class="higlight">February, 2013</span> Zend Optimizer+ integrated into 5.5</a></li>
		
		<li><a href="http://lenss.nl/2013/02/phpness-serious-wtf/"><span class="higlight">February, 2013</span> PHPness Serious WTF</a></li>
		
		<li><a href="http://lenss.nl/2012/11/publish-google-reader-shared-items/"><span class="higlight">November, 2012</span> Publish Google Reader shared items</a></li>
		
		<li><a href="http://lenss.nl/2012/10/long-running-php-script-and-mysql-server-gone-away/"><span class="higlight">October, 2012</span> Long running PHP script and MySQL server gone away</a></li>
		
		<li><a href="http://lenss.nl/2012/10/git-rebase-on-pull-by-default/"><span class="higlight">October, 2012</span> Git: Rebase on pull by default</a></li>
		
		<li><a href="http://lenss.nl/2012/10/workaround-ubuntu-12-04-mysterious-system-freezes/"><span class="higlight">October, 2012</span> Workaround Ubuntu 12.04 mysterious system freezes</a></li>
		
		<li><a href="http://lenss.nl/2012/09/fixing-character-replacement-in-wordpress/"><span class="higlight">September, 2012</span> Fixing character replacement in Wordpress</a></li>
		
		<li><a href="http://lenss.nl/2012/09/resize-a-vagrant-vmdk-drive/"><span class="higlight">September, 2012</span> Resize a Vagrant VMDK drive</a></li>
		
	</ul>
</div>
</section>

<div class="sidebox ad">
	<script type="text/javascript"><!--
	google_ad_client = "ca-pub-0921745317573569";
	/* nlblue_side */
	google_ad_slot = "7706621160";
	google_ad_width = 300;
	google_ad_height = 250;
	//-->
	</script>
	<script type="text/javascript"
	src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
	</script>
</div>
<div class="sidebox">
	<h1>Tags</h1>
	<ul id="tag-cloud" class="blocklist"><a href='http://lenss.nl/tag/-home' style='font-size: 116.69565217391305%'>/home(32)</a> <a href='http://lenss.nl/tag/code' style='font-size: 160.0%'>Code(115)</a> <a href='http://lenss.nl/tag/design' style='font-size: 103.1304347826087%'>Design(6)</a> <a href='http://lenss.nl/tag/freelance' style='font-size: 102.08695652173913%'>Freelance(4)</a> <a href='http://lenss.nl/tag/google' style='font-size: 101.56521739130434%'>Google(3)</a> <a href='http://lenss.nl/tag/javascript' style='font-size: 104.17391304347827%'>Javascript(8)</a> <a href='http://lenss.nl/tag/jquery' style='font-size: 101.04347826086956%'>Jquery(2)</a> <a href='http://lenss.nl/tag/magento' style='font-size: 101.04347826086956%'>Magento(2)</a> <a href='http://lenss.nl/tag/php' style='font-size: 133.91304347826087%'>PHP(65)</a> <a href='http://lenss.nl/tag/security' style='font-size: 104.17391304347827%'>Security(8)</a> <a href='http://lenss.nl/tag/sql' style='font-size: 103.1304347826087%'>SQL(6)</a> <a href='http://lenss.nl/tag/tech' style='font-size: 150.6086956521739%'>Tech(97)</a> <a href='http://lenss.nl/tag/zend' style='font-size: 104.17391304347827%'>Zend(8)</a> </ul>
	<div style="clear:both;"></div>
</div>
<section>
  <div class="sidebox">
	<h1>GitHub Repos</h1>
	
	<ul class="linklist" id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/tlenss" class="github-follow-button">Follow On GitHub</a>
  <script type="text/javascript" src="http://octophile.com/widgets.js"></script>
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = 'http://lenss.nl/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'tlenss',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="http://lenss.nl/javascripts/github.js" type="text/javascript"> </script>
</div>
</section>

<section>
  <div class="sidebox">
	<h1>Latest Tweets</h1>
	<ul class="linklist" id="tweets">
    <li class="loading"><span class="higlight">Status updating...</span></li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("tlenss", 4, false);
    });
  </script>
  <script src="http://lenss.nl/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/tlenss" class="twitter-follow-button" data-show-count="false">Follow @tlenss</a>
  
</div>
</section>


  
</div>

<footer role="contentinfo">
</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tlenss';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>