
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>PHP & DOMDocument slow loading pages - Thijs Lensselink's Blog</title>
  <meta name="author" content="Thijs Lensselink">

  
  <meta name="description" content="PHP & DOMDocument Slow Loading Pages While trying to load a very basic XML template with DOMDocument::load() i ran into some issues last Friday. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tlenss.github.com/2011/03/28/php-domdocument-slow-loading-pages/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/style.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/libs/jquery-1.8.1.js"></script>
  <link href="http://feeds.feedburner.com/ThijsLensselinksBlog" rel="alternate" title="Thijs Lensselink's Blog" type="application/atom+xml">
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8003524-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <script type="text/javascript">
	$(document).ready(function() {
		$('#logo').click(function() {
			window.location = '/';
		});
	});
  </script>
</head>

<body   >
<div id="content">
	<div class="inner">
        <div>
<article class="hentry" role="article">
  
<article>
	<header>
		<header>
		
		  <h1 class="entry-title">PHP & DOMDocument Slow Loading Pages</h1>
		
		</header>
	</header>

	
	<div class="articletext"><p>While trying to load a very basic XML template with <a href="http://nl.php.net/manual/en/domdocument.load.php">DOMDocument::load()</a> i ran into some issues last Friday. During the weekend i completely forgot about this. Thank god :) But since it&#8217;s Monday i have no other option then to solve it. The problem i was experiencing was page loads took about 2 minutes for every controller action in the application. My first thought was that it would be related to permissions. The application not being able to write certain files. But after checking all permissions the problems still remained.</p>

<p>The logs weren&#8217;t showing anything. No errors, nothing. Time to enable the <a href="http://www.xdebug.org/">XDebug</a> profiler. And after doing a few requests and loading them up in <a href="http://kcachegrind.sourceforge.net/html/Home.html">KCachegrind</a> i found the root of the problem quite fast. A call to the mkDom method was causing the slow load.</p>

<p><a href="http://lenss.nl/images/2011/03/php-dom_1.png"><img src="http://lenss.nl/images/2011/03/php-dom_1-300x59.png" alt="" /></a></p>

<p>But because there are no errors or other indications something is wrong. I added some debug statements to the code in question. And found out that it was PHP&#8217;s native DOMDocument::load() that was taking two minutes to load a 200k XML template. That&#8217;s not good. So what&#8217;s going on here?</p>

<p><a href="http://lenss.nl/images/2011/03/php-dom_2.png"><img src="http://lenss.nl/images/2011/03/php-dom_2-300x41.png" alt="" /></a></p>

<p>First let&#8217;s check why there are no errors. Turns out that for some specific reason <a href="http://nl2.php.net/manual/en/libxml.constants.php">LIBXML_NOERROR</a> is set. And after disabling this i was presented with an error.</p>

<blockquote><p>Caught exception: ErrorException: DOMDocument::load()
Entity &#8216;nbsp&#8217; not defined in /some/file.tal.html, line: 363</p></blockquote>

<p>WTF? HTML entities inside a XML template. O well. So i changed the  &#8216;s inside the template to their XML equivalent</p>

<p>Reloaded the page and everything is fast again. This solved my problem. But i wasn&#8217;t happy yet. Nobody else was experiencing this issue in the office. So there had to be some other issue. That&#8217;s when Geoff notified me about the fact that DTD checks are disabled by using <a href="http://nl2.php.net/manual/en/libxml.constants.php">LIBXML_NONET</a>. For this to work however there needs to be an extra W3C package installed.</p>

<p><a href="http://lenss.nl/images/2011/03/php-dom_3.png"><img src="http://lenss.nl/images/2011/03/php-dom_3-300x7.png" alt="" /></a></p>

<p>This was one of those hard to track errors. But it&#8217;s fixed and everything is running smooth again.</p>
</div>
	

	<div style="clear:both;"></div>
	<footer>
		on 








  


<time datetime="2011-03-28T14:53:45+02:00" pubdate data-updated="true">Mar 28<span>th</span>, 2011</time>
		<div class="share">
			<ul>
				<li><a href="#disqus_thread">Comments</a></li>
			</ul>
		</div>
	</footer>
</article>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Thijs Lensselink</span></span>

      








  


<time datetime="2011-03-28T14:53:45+02:00" pubdate data-updated="true">Mar 28<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/categories/code/'>Code</a>, <a class='category' href='/categories/php/'>PHP</a>, <a class='category' href='/categories/tech/'>Tech</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://tlenss.github.com/2011/03/28/php-domdocument-slow-loading-pages/" data-via="tlenss" data-counturl="http://tlenss.github.com/2011/03/28/php-domdocument-slow-loading-pages/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2011/03/25/writing-a-simple-wordpress-plugin/" title="Previous Post: Writing a simple Wordpress plugin">&laquo; Writing a simple Wordpress plugin</a>
      
      
        <a class="basic-alignment right" href="/2011/04/17/vim-for-a-php-developer/" title="Next Post: VIM for a PHP developer">VIM for a PHP developer &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>
	</div>
</div>

<div id="sidebar">
  
    Liquid syntax error: if tag was never closed
  
</div>

<footer role="contentinfo"><p>
  Copyright &copy; 2012 - Thijs Lensselink -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tlenss';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://tlenss.github.com/2011/03/28/php-domdocument-slow-loading-pages/';
        var disqus_url = 'http://tlenss.github.com/2011/03/28/php-domdocument-slow-loading-pages/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>